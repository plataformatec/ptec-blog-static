<!DOCTYPE html>
<html dir="ltr" lang="en-US" prefix="og: https://ogp.me/ns#">
<head>
  <meta charset="utf-8">
  <meta name="bitly-verification" content="b3acd9a47f4e">

  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="emoji:root" content="/wp-content/themes/ptec">
  <meta name="theme-color" content="#cacaca">
  
    <meta name="bitly-verification" content="b3acd9a47f4e">
  <meta property="og:image" content="/wp-content/themes/ptec/assets/opengraph.png">
  <link rel="icon" sizes="192x192" href="/wp-content/themes/ptec/assets/icons/chrome-192x.png">
  <link rel="pingback" href="/xmlrpc.php">
  
		<!-- All in One SEO 4.5.4 - aioseo.com -->
		<title>Why your web framework should not adopt Rack API « Plataformatec Blog</title>
		<meta name="description" content="Or, even better, why your web framework should not adopt a CGI-based API. For the past few years I have been studying and observing the development of different emerging languages closely with a special focus on web frameworks/servers. Unfortunately, most of the new web frameworks are following the Rack/WSGI specification which may be a mistake">
		<meta name="robots" content="max-image-preview:large">
		<link rel="canonical" href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/">
		<meta name="generator" content="All in One SEO (AIOSEO) 4.5.4">
		<meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="Plataformatec Blog | Plataformatec&#039;s place to talk about Ruby, Ruby on Rails, Elixir, and software engineering">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Why your web framework should not adopt Rack API « Plataformatec Blog">
		<meta property="og:description" content="Or, even better, why your web framework should not adopt a CGI-based API. For the past few years I have been studying and observing the development of different emerging languages closely with a special focus on web frameworks/servers. Unfortunately, most of the new web frameworks are following the Rack/WSGI specification which may be a mistake">
		<meta property="og:url" content="/2012/06/why-your-web-framework-should-not-adopt-rack-api/">
		<meta property="article:published_time" content="2012-06-15T14:00:36+00:00">
		<meta property="article:modified_time" content="2012-06-16T17:55:05+00:00">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content="Why your web framework should not adopt Rack API « Plataformatec Blog">
		<meta name="twitter:description" content="Or, even better, why your web framework should not adopt a CGI-based API. For the past few years I have been studying and observing the development of different emerging languages closely with a special focus on web frameworks/servers. Unfortunately, most of the new web frameworks are following the Rack/WSGI specification which may be a mistake">
		<meta name="google" content="nositelinkssearchbox">
		<script type="application/ld+json" class="aioseo-schema">{"@context":"https:\/\/schema.org","@graph":[{"@type":"Article","@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#article","name":"Why your web framework should not adopt Rack API « Plataformatec Blog","headline":"Why your web framework should not adopt Rack API","author":{"@id":"\/author\/josevalim\/#author"},"publisher":{"@id":"\/#organization"},"datePublished":"2012-06-15T11:00:36-03:00","dateModified":"2012-06-16T14:55:05-03:00","inLanguage":"en-US","commentCount":14,"mainEntityOfPage":{"@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#webpage"},"isPartOf":{"@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#webpage"},"articleSection":"English, cgi, rack, rails, streaming"},{"@type":"BreadcrumbList","@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#breadcrumblist","itemListElement":[{"@type":"ListItem","@id":"\/#listItem","position":1,"name":"Home","item":"\/","nextItem":"\/2012\/#listItem"},{"@type":"ListItem","@id":"\/2012\/#listItem","position":2,"name":"2012","item":"\/2012\/","nextItem":"\/2012\/06\/#listItem","previousItem":"\/#listItem"},{"@type":"ListItem","@id":"\/2012\/06\/#listItem","position":3,"name":"June","item":"\/2012\/06\/","nextItem":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#listItem","previousItem":"\/2012\/#listItem"},{"@type":"ListItem","@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#listItem","position":4,"name":"Why your web framework should not adopt Rack API","previousItem":"\/2012\/06\/#listItem"}]},{"@type":"Organization","@id":"\/#organization","name":"Plataformatec Blog","url":"\/"},{"@type":"Person","@id":"\/author\/josevalim\/#author","url":"\/author\/josevalim\/","name":"José Valim","image":{"@type":"ImageObject","@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#authorImage","url":"https:\/\/secure.gravatar.com\/avatar\/e837f6b7fd146ab16ed3d663476c063e?s=96&d=mm&r=pg","width":96,"height":96,"caption":"José Valim"}},{"@type":"WebPage","@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#webpage","url":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/","name":"Why your web framework should not adopt Rack API « Plataformatec Blog","description":"Or, even better, why your web framework should not adopt a CGI-based API. For the past few years I have been studying and observing the development of different emerging languages closely with a special focus on web frameworks\/servers. Unfortunately, most of the new web frameworks are following the Rack\/WSGI specification which may be a mistake","inLanguage":"en-US","isPartOf":{"@id":"\/#website"},"breadcrumb":{"@id":"\/2012\/06\/why-your-web-framework-should-not-adopt-rack-api\/#breadcrumblist"},"author":{"@id":"\/author\/josevalim\/#author"},"creator":{"@id":"\/author\/josevalim\/#author"},"datePublished":"2012-06-15T11:00:36-03:00","dateModified":"2012-06-16T14:55:05-03:00"},{"@type":"WebSite","@id":"\/#website","url":"\/","name":"Plataformatec Blog","description":"Plataformatec's place to talk about Ruby, Ruby on Rails, Elixir, and software engineering","inLanguage":"en-US","publisher":{"@id":"\/#organization"}}]}</script>
		<!-- All in One SEO -->


		<!-- Meta Tag Manager -->
		<meta name="twitter:label1" content="Plataformatec">
		<meta name="twitter:data1" content="Professional Consulting and Development for companies using Elixir or Ruby">
		<!-- / Meta Tag Manager -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Comments Feed" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Why your web framework should not adopt Rack API Comments Feed" href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/feed/">
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.4.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🫱🏻‍🫲🏿","🫱🏻​🫲🏿")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=6.4.2" type="text/css" media="all">
<style id="wp-block-library-inline-css" type="text/css">.has-text-align-justify{text-align:justify;}</style>
<link rel="stylesheet" id="mediaelement-css" href="/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="/wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=6.4.2" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="webfont-css" href="//fonts.googleapis.com/css?family=Bree+Serif&#038;ver=6.4.2" type="text/css" media="all">
<link rel="stylesheet" id="main-css" href="/wp-content/themes/ptec/style.css?ver=6.4.2" type="text/css" media="all">
<link rel="stylesheet" id="tablepress-default-css" href="/wp-content/plugins/tablepress/css/build/default.css?ver=2.2.4" type="text/css" media="all">
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/2820">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.4.2">
<link rel="shortlink" href="/?p=2820">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F2012%2F06%2Fwhy-your-web-framework-should-not-adopt-rack-api%2F">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F2012%2F06%2Fwhy-your-web-framework-should-not-adopt-rack-api%2F#038;format=xml">
</head>
  <body class="post-template-default single single-post postid-2820 single-format-standard">
    <div class="site-header">
      <div class="site-header-background">
        <header class="site-header-container">
          <h1 class="site-header-logo">
            <a href="/">
              <img src="/wp-content/themes/ptec/assets/plataformatec.svg" height="70" alt="The plataformatec logo">
            </a>
          </h1>

          <form class="header-search-form" method="GET" action="/">
            <input type="search" name="s" placeholder="Search our blog..." class="header-search-input">
          </form>

          <ul class="site-nav">
            <li class="site-nav-item"><a href="http://plataformatec.com.br/services">Services</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/playbook">Playbook</a></li>
            <li class="site-nav-item handheld-hidden"><a href="http://plataformatec.com.br/forge">Forge</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/careers">Careers</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/contact">Contact</a></li>
          </ul>
        </header>
      </div>
      <nav class="header-nav">
        <input type="checkbox" id="nav-toggle-checkbox" class="header-nav-checkbox">
        <label for="nav-toggle-checkbox" class="header-nav-toggle">Topics we write about</label>

        <ul class="header-nav-list" itemscope itemtype="http://schema.org/SiteNavigationElement">
          <li class="header-nav-item header-search-nav-item">
            <form class="header-nav-search-form" method="GET" action="/">
              <input type="search" name="s" placeholder="Search our blog..." class="header-search-input">
            </form>
          </li>
                    <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/elixir" itemprop="url">Elixir</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/rails" itemprop="url">Ruby on Rails</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/devise" itemprop="url">Devise</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/simple_form" itemprop="url">Simple Form</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/agile" itemprop="url">Agile</a>
          </li>
        </ul>
      </nav>
    </div>
<div class="site-container">
  <div class="page-container">
                  <section class="post-section">
  <header class="post-header">
    <h1 class="post-title">
      <a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/" rel="bookmark">Why your web framework should not adopt Rack API</a>
    </h1>
          <time class="post-date-ribbon" datetime="2012-06-15T11:00:36-03:00">Jun 15, 2012</time>
      <p class="post-author">
        <img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">        Written by <a href="/?author=4" title="Posts by José Valim">José Valim</a>.
      </p>
        </header>

      <article class="post-body">
      <p>Or, even better, why your web framework should not adopt a CGI-based API.</p>
<p>For the past few years I have been studying and observing the development of different emerging languages closely with a special focus on web frameworks/servers. Unfortunately, most of the new web frameworks are following the Rack/WSGI specification which may be a mistake depending on the platform you are targeting (particularly true for Erlang and Node.js which have very strong streaming foundations and is by default part of their stack).</p>
<p>This blog post is an attempt to detail the limitations in the Rack/CGI-based APIs that the Rails Core Team has found while working with the streaming feature that shipped with Rails 3.1 and why we need better abstractions in the long term.</p>
<h3>Case in study</h3>
<p>The use case we have in mind here is streaming. In Rails, we have focused on streaming as a way to quickly return the head of the HTML page to the browser, so the browser can start downloading assets (like javascript and stylesheet) while the server is generating the rest of the page. There is <a href="http://weblog.rubyonrails.org/2011/4/18/why-http-streaming/" target="_blank">a great entry on Rails weblog about streaming in general</a> and <a href="http://railscasts.com/episodes/266-http-streaming" target="_blank">a Railscast if you want to focus on how to use it in your Rails applications</a>. However, streaming is not only limited to HTML responses and can also be useful in API endpoints, for example, to stream search results as they pop-up or to synchronize with mobile devices.</p>
<h3>The Rack specification in a nutshell</h3>
<p>In Rack, the response is made by an array with three elements: <code>[status, headers, body]</code></p>
<p>The body can be any object that responds to the method <code>each</code>. This means streaming can be done by passing an object that will, for example, lazily read a file and stream chunks when <code>each</code> is called.</p>
<p>A Rack application is any object that implements the method <code>call</code> and receives an environment hash/dictionary with the request information. When I said above that most new web frameworks are following the Rack specification, is because they are introducing an API similar to this one just described.</p>
<h3>The issue</h3>
<p>In order to understand the issue, we will consider three entities: the client, the server and the application. The client (for example a browser) sends a request to the server which forwards it to an application. In this case, the server and the application are communicating via the Rack API.</p>
<p>The issue in streaming cases is that, sending a response back from the application does not mean the application finished processing. For example, consider a middleware (a middleware is an object that sits in between the server and our application) that opens up a connection to the database for the duration of the request and cleans it afterwards:</p>
<pre lang="ruby">
def call(env)
  connection = DB.checkout_connection
  env["db.connection"] = connection
  @app.call(env)
ensure
  DB.checkin_connection connection
end
</pre>
<p>Without streaming, it would work as follow:</p>
<ol>
<li>The server receives a request and passes it down the stack</li>
<li>The request reaches the middleware</li>
<li>The middleware checks out the connection</li>
<li>The application is invoked, renders a view accessing the database using the connection and returns the rendered view as a string</li>
<li>The middleware checks the connection back in</li>
<li>The response is sent back to the client</li>
</ol>
<p>With streaming, this would happen:</p>
<ol>
<li>The server receives a request and passes it down the stack</li>
<li>The request reaches the middleware</li>
<li>The middleware checks out the connection</li>
<li>The app is called but does not render anything. Instead it returns a lazy object as response body that will stream the HTML page in chunks as the `each` method is called</li>
<li>The middleware checks the connection back in</li>
<li>Back in the server, we have received the lazy body and will start to stream it</li>
<li>While streaming the body, since the body is lazily calculated, now is the time it must access the database. But, since the middleware already checked the connection back in, our code will fail with a &#8220;not connected&#8221; exception</li>
</ol>
<p>The first reaction to solve this issue is to ensure that all streaming happens inside the application, i.e. the application would have a mechanism to stream the response back and only when it is done it would return the Rack response back. However, if the application does this, any middleware that desires to modify the header or the response body won&#8217;t be able to do so because the response was already streamed from inside the application.</p>
<p>Our work-around for Rails was to create proxies that wrap the response body:</p>
<pre lang="ruby">
def call(env)
  connection = DB.checkout_connection
  env["db.connection"] = connection
  response = @app.call(env)
  ResponseProxy.new(response).on_close do
    DB.checkin_connection connection
  end
end
</pre>
<p>However, this is inefficient and extremely limited (not all middleware can be converted to such approach). In order for streaming to be successful, the underlying server API needs to acknowledge that the headers and the response body can be sent at different times. Not only that, it needs to provide proper callbacks around the response lifecycle (before sending headers, when the response is closed, on each stream, etc).</p>
<p>The trade-off here is that this can no longer be achieved with an easy API as Rack&#8217;s. In general, we would like to have a response objects that provides several life-cycle hooks. For example, the middleware above could be rewritten as:</p>
<pre lang="ruby">
def call(request, response)
  connection = DB.checkout_connection
  request.env["db.connection"] = connection
  response.on_close { DB.checkin_connection(connection) }
  @app.call(request, response)
end
</pre>
<p>The Java Servlet specification is a good example of how request and response objects could be designed to provide such hooks.</p>
<h3>Other middleware</h3>
<p>In the example above I focused on the database connection middleware but this limitation exists, in one way or the other, in the majority of middleware in a stack. For example, a middleware that rescues any exception inside the application to render a 500 page also needs to be adapted. Other middleware simply won&#8217;t work. For instance, Rails ships with a middleware that provides an ETag header based on the body which has to be disabled when streaming.</p>
<h3>Looking back</h3>
<p>Does this mean moving to Rack was a mistake? <b>Not at all</b>. Rack appeared when the web development Ruby community was fragmented and the simplicity of the Rack API made it possible to unify the different web frameworks and web servers available. Looking back, I would take the standardization provided by Rack any day regardless of the limitations it brings. Now that we have a standard, we are already working on addressing such issues, which leads us to&#8230;</p>
<h3>Looking forward</h3>
<p>Streaming will become more and more important. While working with HTML streaming requires special attention both technically and also in terms of usability, <a href="http://api.rubyonrails.org/classes/ActionController/Streaming.html" target="_blank">as outlined in Rails&#8217; documentation</a>, API endpoints could benefit from it with basically no extra cost. Not only that, features in HTML5 like server-sent events could easily be built on top of streaming without requiring a specific end-point in your application to handle them.</p>
<p>While CGI was originally streaming friendly, the abstractions we built on top of it (like middleware) are not. I believe web frameworks should be moving towards better connection/socket abstractions and away from the old CGI-based APIs, which served us well but it is finally time for us to let it go.</p>
<p>PS: Thanks to <a href="http://twitter.com/tenderlove" target="_blank">Aaron Patterson</a> (who has also written about this issue <a href="http://tenderlovemaking.com/2011/03/03/rack-api-is-awkward.html" target="_blank">in his blog</a>), <a href="http://twitter.com/wycats" target="_blank">Yehuda Katz</a>, <a href="http://twitter.com/konstantinhaase" target="_blank">Konstantin Haase</a> and <a href="http://twitter.com/raggi" target="_blank">James Tucker</a> for early review and feedback.</p>
<h3>F.A.Q.</h3>
<p>This section was added after the blog post was released based on some common questions.</p>
<p><b>Q:</b> Isn&#8217;t it a bad idea to mix both streaming and non-streaming behavior in the same stack?</p>
<p>That depends on the stack. This is definitely not an issue with Erlang and Node.js since both stacks are streaming based. In Ruby, I believe a threaded jRuby or Thin will allow you to get away with keeping a socket open waiting for responses, but it will probably turn out to be a bad idea with other servers since the process holding the socket won&#8217;t be able to respond to any other request.</p>
<p><b>Q:</b> Is there a need to do everything streaming based when a request/response would be fine?</p>
<p>No, there is no need. The point of the blog post is <b>not</b> to advocate for streaming only frameworks, but simply state that a Rack API may severely limit your streaming capability in case your platform supports it. Personally, I would like to be able to choose and mix both, if my stack allows me to do so.</p>
    </article>
  
      <p class="post-metadata">
      Tags: <a href="/tag/cgi/" rel="tag">cgi</a>, <a href="/tag/rack/" rel="tag">rack</a>, <a href="/tag/rails/" rel="tag">rails</a>, <a href="/tag/streaming/" rel="tag">streaming</a>, Posted in <a href="/category/english/" rel="category tag">English</a>,   <a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comments"><span class="dsq-postid" data-dsqidentifier="2820 http://blog.plataformatec.com.br/?p=2820">14 Comments &#187;</span></a>    </p>
  </section>

        <div class="comments-thread">
          
<!-- You can start editing here. -->

	<h3 id="comments">
		14 responses to &#8220;Why your web framework should not adopt Rack API&#8221;	</h3>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1" id="comment-1234">
				<div id="div-comment-1234" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/8cbd31fea81477c4b353eb32209df69f?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/8cbd31fea81477c4b353eb32209df69f?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">			<cite class="fn"><a href="http://blog.fxposter.org/" class="url" rel="ugc external nofollow">Pavel Forkert</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1234">June 15, 2012 at 11:27 am</a>		</div>

		<p>Yes, it was clear that current Rack API is not suitable for streaming, websockets, etc. But are there any concrete plans? Rewrite Rack and drop compatibility with current middlewares?</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1235">
				<div id="div-comment-1235" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/a6791caad48e6e3736432b450fb4cd0a?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/a6791caad48e6e3736432b450fb4cd0a?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">			<cite class="fn">Gerard Vignes</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1235">June 15, 2012 at 11:48 am</a>		</div>

		<p>I use Rack::Static, :urls=&gt;{&#8230;} to identify cases where I just need a file delivered statically&#8212;perhaps there should be something like Rack::Stream, :urls=&gt;{&#8230;}</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1236">
				<div id="div-comment-1236" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo avatar-default" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="http://twitter.com/mauriciojr" class="url" rel="ugc external nofollow">Maurício Linhares</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1236">June 15, 2012 at 12:11 pm</a>		</div>

		<p>Placing streaming and action-based webapps in the same basket is dangerous. You can&#8217;t just &#8220;enable streaming&#8221; and hope it will work for all apps at the same time. Building a streaming/always connected solution requires a massive change to the way the apps are built, just look at NodeJS in JavaScript, BlueEyes/Spray in Scala, they are built in a completely different way and that&#8217;s how it should be done.</p>
<p>Hiding the details and pros and cons of building a streaming webapp by a &#8220;common platform&#8221; using an action-based framework is just going to create new problems for developers. If you want streaming, you neeed to build your app from the ground up with that.</p>
<p>Also, on common APIs, the Java Servlet API just added support for streaming/websockets apps using specific (and a different) request cycle, separated form the common request/response cycle of the common Java Servlet.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1237">
				<div id="div-comment-1237" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/382c035a12292d8dfa44ee531cbbfb33?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/382c035a12292d8dfa44ee531cbbfb33?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn">Troy Kruthoff</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1237">June 15, 2012 at 1:00 pm</a>		</div>

		<p>Jose and Aaron are spot on that this needs to change, the sooner the better.  It is a huge hole in Rails concurrency.  As mentioned in the post, Java does a lot right here, but so does node.js  If you look at how connect implements middleware (<a href="http://www.senchalabs.org/connect/" rel="nofollow ugc">http://www.senchalabs.org/connect/</a>) it has 2 key features that make anything on the radar today possible:</p>
<p>1)  request and response can pub/sub events (on::data, on::end, etc).<br>
2)  middleware app has to explicitly call next for the chain to continue.  </p>
<p>The coolest part about #1 is middleware can inject functionality to happen later, this is how they implement x-runtime:</p>
<p>module.exports = function responseTime(){<br>
  return function(req, res, next){<br>
    var start = new Date;</p>
<p>    if (res._responseTime) return next();<br>
    res._responseTime = true;</p>
<p>    res.on(&#8216;header&#8217;, function(header){<br>
      var duration = new Date &#8211; start;<br>
      res.setHeader(&#8216;X-Response-time&#8217;, duration + &#8216;ms&#8217;);<br>
    });</p>
<p>    next();<br>
  };<br>
};</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1238">
				<div id="div-comment-1238" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="/" class="url" rel="ugc">josevalim</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1238">June 15, 2012 at 1:23 pm</a>		</div>

		<p>&gt; You can&#8217;t just &#8220;enable streaming&#8221; and hope it will work for all apps at the same time.</p>
<p>Yes, this is correct. However, I disagree with other points in your comment. First, I wouldn&#8217;t put streaming and always connected/websockets in the same bucket. The latter certainly can&#8217;t be mixed and that&#8217;s why I haven&#8217;t mentioned it in the blog post.</p>
<p>Also, the blog post is focusing at the framework infrastructure layer and there is absolutely no need to have two completely different infrastructures, as they certainly share a lot. After all, an action based app is simply a streaming application that streams just once (the headers + body at once). The problem is that the Rack API limits us on this subset scenario, making it hard for us to properly support streaming for those who need to.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1239">
				<div id="div-comment-1239" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/ff04a483a23bec50e4a44cd94ee43e9d?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/ff04a483a23bec50e4a44cd94ee43e9d?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn">donaldball</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1239">June 15, 2012 at 2:00 pm</a>		</div>

		<p>Are you advocating that Rack evolve to support streaming with the callback hooks you describe in your final code example, or do you think we need something entirely new?</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1240">
				<div id="div-comment-1240" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="/" class="url" rel="ugc">josevalim</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1240">June 15, 2012 at 2:35 pm</a>		</div>

		<p>I believe Rack should evolve. We can&#8217;t afford to go back to the state we had before Rack.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1241">
				<div id="div-comment-1241" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/b9062a7086ee183d7f14e9decf05f8ab?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/b9062a7086ee183d7f14e9decf05f8ab?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn">nfluxx</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1241">June 15, 2012 at 3:14 pm</a>		</div>

		<p>So Python has a similar spec called WSGI that solves/helps this problem in a couple ways.</p>
<p>First, for some quick background: When a WSGI app is called, the function takes two arguments &#8211; the &#8220;environ&#8221; for the request and a &#8220;start_response&#8221; callable.  The app then returns an interator object, which the server iterates over until the end of the response.  It&#8217;s the app author&#8217;s job to call the start_response callable <i>no later</i> than the first iteration of the iterator.</p>
<p>1. The generation of the HTTP status and headers is decoupled from the response body.  This is accomplished by using the start_response callable an make calling of it decoupled from returning the response body iterator.</p>
<p>2. It&#8217;s possible in WSGI to have a middleware that is wrapping an app delegate it&#8217;s own .next() call (.each in Ruby) to the underlying app it&#8217;s written in.  When the server calls the middleware (which wraps the app) it gets back the middleware&#8217;s iterator rather than the app&#8217;s iterator.  The middleware can then be notified with the app is done iterating a response (via a StopIteration exception) and then it can do the right thing &#8211; i.e. in your example, check in the DB connection.</p>
<p>Hope that helps!</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1242">
				<div id="div-comment-1242" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo avatar-default" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="http://twitter.com/mauriciojr" class="url" rel="ugc external nofollow">Maurício Linhares</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1242">June 15, 2012 at 3:20 pm</a>		</div>

		<p>Very simple example, stream a large (more than 100mb file), you can&#8217;t possibly do this in an action based framework without magic (like x-seendfile) simple because you would never want to hang up a thread doing expensive IO operations both on your disk and network, you would select an efficient async implementation that would only write to the socket if there is a buffer available for it.</p>
<p>Another example, reverse proxy, you just can&#8217;t write an efficient reverse proxy implementation using the usual request-response cycle inside of a thread, again due to the IO constraints.</p>
<p>So, while it&#8217;s perfectly possible to build an async backend and make it look synchronous for clients, it&#8217;s a serious waste of resources and could lead to subtle, hard-to-pinpoint bugs.</p>
<p>That&#8217;s why I really don&#8217;t believe having a single point of entry for both solutions would work, the abstractions would easily leak to the top level layers (the app layer) and people would be struggling to understand what&#8217;s going wrong. The Java servlet model is possibly the best, if you want to go request-response directly, just stay where you are, if you want do to streaming or async solutions, pick the new async API and enjoy it.</p>
<p>If there is code that can be shared between both implementations, awesome, share it, but don&#8217;t force a single model on top of two very different solutions to the problem.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1243">
				<div id="div-comment-1243" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="/" class="url" rel="ugc">josevalim</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1243">June 15, 2012 at 3:50 pm</a>		</div>

		<p>I think we are agreeing then. This is very platform specific so when running on Node.js or Erlang (or thin in Ruby) the backend is inherently async so the cost you mention is quite low (which was what I was arguing). But you are totally correct that depending on your platform, the cost may not be worth it and grab a different stack.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1245">
				<div id="div-comment-1245" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e94a065789007e8c3301ae1d726e6537?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e94a065789007e8c3301ae1d726e6537?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn">Richard Bucker</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1245">June 16, 2012 at 1:40 pm</a>		</div>

		<p>I think this is an oversimplification of the solution for which there is no problem. There are a number of use-cases for which streaming is not the answer. I can probably come up with more antipatterns than patterns.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1246">
				<div id="div-comment-1246" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="/" class="url" rel="ugc">josevalim</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1246">June 16, 2012 at 2:31 pm</a>		</div>

		<p>Richard, thanks for the comment. Can you please be a bit more specific?</p>
<p>&gt; I think this is an oversimplification of the solution for which there is no problem.</p>
<p>What is an oversimplication? Which solution (the middleware example given or a Rack API alternative)?</p>
<p>&gt; There are a number of use-cases for which streaming is not the answer.</p>
<p>Agreed. I didn&#8217;t say at any moment that streaming is the solution to all problems. In fact, streaming html responses leads to a number of complications, as linked in the post above.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1247">
				<div id="div-comment-1247" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/8cbd31fea81477c4b353eb32209df69f?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/8cbd31fea81477c4b353eb32209df69f?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="http://blog.fxposter.org/" class="url" rel="ugc external nofollow">Pavel Forkert</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1247">June 18, 2012 at 8:45 am</a>		</div>

		<p> Yeah, I saw your gist earlier. It would be cool, if rack will evolve in it&#8217;s API, but providing compatibility layer for &#8220;non-streaming&#8221; apps (in rails&#8217; terms).</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1248">
				<div id="div-comment-1248" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/4dea430d31b993abaf41cd9b54f8128d?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/4dea430d31b993abaf41cd9b54f8128d?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="http://avdi.org/" class="url" rel="ugc external nofollow">Avdi Grimm</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2012/06/why-your-web-framework-should-not-adopt-rack-api/#comment-1248">June 21, 2012 at 5:27 pm</a>		</div>

		<p>&gt; In general, we would like to have a response objects that provides several life-cycle hooks</p>
<p>I seem to recall saying the same thing to Aaron at some conference a year or so ago. Rack is a great simplifying abstraction, but there&#8217;s a limit to what you can do with just one event hook (&#8220;on_request&#8221;, effectively).</p>

		
				</div>
				</li>
<!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

        </div>

        <div class="pagination-section">
          <a href="/2012/06/improving-the-integration-between-capybara-and-rspec/" rel="prev">Improving the integration between Capybara and RSpec</a>          <a href="/2012/06/about-the-composed_of-removal/" rel="next">About the composed_of removal</a>        </div>
        </div>
  <aside class="sidebar-container">
  <div class="sidebar-box sidebar-box-divider">
    <ul class="social-links">
      <li><a href="/feed/" class="social-link rss-link" title="Subscribe to our RSS" target="_blank">Subscribe to our RSS</a></li>
      <li><a href="http://twitter.com/plataformatec" class="social-link twitter-link" title="Follow us on Twitter" target="_blank">@plataformatec</a></li>
      <li><a href="https://github.com/plataformatec" class="social-link github-link" title="Check our code at GitHub" target="_blank">Plataformatec @ GitHub</a></li>
      <li><a href="http://facebook.com/plataformatec.com.br" class="social-link facebook-link" title="Check our Facebook page" target="_blank">Plataformatec @ Facebook</a></li>
      <li><a href="http://www.linkedin.com/company/plataformatec" class="social-link linkedin-link" title="Check our LinkedIn page" target="_blank">Plataformatec @ LinkedIn</a></li>
    </ul>
  </div>

  <div class="sidebar-box sidebar-box-divider">
    This is the company blog of <strong>Plataformatec</strong>, a software development and
    consultancy company, specialized in Elixir, Ruby and Agile.
  </div>

  <div class="sidebar-box">
    <ul class="post-list">
      <li class="post-list-item">
<a href="/category/english">Posts in english</a> (107)</li>
      <li class="post-list-item">
<a href="/category/portugues">Posts em português</a> (33)</li>
    </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Recent Posts</h3>

    <ul class="post-list">
                    <li class="post-list-item">
          <a href="/2020/01/important-information-about-our-elixir-and-ruby-open-source-projects/">Important information about our Elixir and Ruby Open Source projects</a>
        </li>
              <li class="post-list-item">
          <a href="/2020/01/elixir-what-about-tests/">Elixir: What about tests?</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/12/okr-licoes-aprendidas-para-voce-comecar-a-aplica-lo-de-forma-efetiva/">OKR: lições aprendidas para você começar a aplicá-lo de forma efetiva</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/11/divida-tecnica-por-que-fazer-quando-fazer-e-como-priorizar/">Dívida técnica: Por que fazer, quando fazer e como priorizar</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/11/relation-between-story-points-and-development-time-lead-time/">Relation between Story Points and Development Time (Lead Time)</a>
        </li>
          </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Read more about</h3>

    <ul class="post-list">
      <li class="post-list-item"><a href="/tag/open-source">Open Source</a></li>
      <li class="post-list-item"><a href="/tag/front-end">Front end</a></li>
      <li class="post-list-item"><a href="/tag/conference">Conferences</a></li>
      <li class="post-list-item"><a href="/tag/security-fix">Security fixes</a></li>
    </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Check our product</h3>
    <a class="sidebar-cta-link" href="https://sourcelevel.io/">
      <img src="/wp-content/themes/ptec/assets/sourcelevel-300.png" width="300" alt="SourceLevel - Analytics for Engineering Ops">
	</a>

    <p align="center">Analytics for Engineering Ops.</p>
  </div>

</aside>
      <footer class="site-footer">
        <p>
          <span class="footer-copy">© 2009- 2024 Plataformatec. All rights reserved.</span>

          <a href="http://plataformatec.com.br/">Our site</a> ·
          <a href="http://plataformatec.com.br/contact">Contact us</a> ·
          <a href="http://twitter.com/plataformatec">@plataformatec</a>
        </p>
      </footer>
    </div>
    <script type="text/javascript" src="/wp-content/themes/ptec/application.js?ver=6.4.2" id="application-js"></script>
  </body>
</html>