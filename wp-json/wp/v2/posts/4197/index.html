{"id":4197,"date":"2014-09-17T09:00:37","date_gmt":"2014-09-17T12:00:37","guid":{"rendered":"http:\/\/blog.plataformatec.com.br\/?p=4197"},"modified":"2014-09-19T12:01:41","modified_gmt":"2014-09-19T15:01:41","slug":"splitting-long-css-files-to-overcome-ie9-4095-rules-limit","status":"publish","type":"post","link":"http:\/\/blog.plataformatec.com.br\/2014\/09\/splitting-long-css-files-to-overcome-ie9-4095-rules-limit\/","title":{"rendered":"Splitting long CSS files to overcome IE9 4095 rules limit"},"content":{"rendered":"<p>CSS preprocessors like SASS and LESS improved the way we write CSS nowadays. It provides better ways to organize styles into files, that can represent a component or page, and then compile into a single file, following the idea of reducing HTTP requests. Also there are other features like variables, mixins and placeholders that help with code reuse and maintenance.<\/p>\n<p>However, it is possible that with the growth of your application code base the number of CSS styles will surpass the limit rules supported by IE9 or above. The current limit is up to <a href=\"http:\/\/blogs.msdn.com\/b\/ieinternals\/archive\/2011\/05\/14\/10164546.aspx\">4095 rules per file<\/a>.<\/p>\n<p>But it is good to note that only the overflowed styles will be ignored. So, considering this detail, you might take some time to figure out that your layout is broken unless you are aware of this issue, since other browsers like Chrome, Safari and Firefox does not have such limit.<\/p>\n<p>The simplest way to fix that is to split your main stylesheet into multiple files. Using a pre-processor makes the job easy, just create another manifest and move some imports to the newest one and problem solved.<\/p>\n<p>Easy, huh? Well, if you have a well organized CSS the job might be straightforward, but if you don&#8217;t, you may struggle with some difficulties.<\/p>\n<p>Here are some experiences that we got when addressing this issue.<\/p>\n<h3>Prefer to use placeholders instead of classes<\/h3>\n<p>We had some CSS styles that used <code>@extend .some-class<\/code> and it caused some problems as the <code>.some-class<\/code> definition is written to the CSS file, even if it is never used. One options is to <a href=\"http:\/\/thesassway.com\/intermediate\/understanding-placeholder-selectors\">convert classes into placeholders<\/a> so they can be reused without being generated.<\/p>\n<p>To make matters worse, <code>.some-class<\/code> was often defined in another file, which led to the file being imported, duplicating its rules over different files. This takes us to our next tip.<\/p>\n<h3>Organize variables and mixins into separated files<\/h3>\n<p>As your codebase grows, it is possible that variables, mixins or placeholders get spread in different files. So, if you have to split a CSS file, or even reorganize it, you will have to carefully ensure that all variables, mixins and placeholders are ported over. Keeping them in their proper files like <code>_variables.scss<\/code> and <code>_mixins.scss<\/code> cleans up the code and makes future refactoring much easier.<\/p>\n<h3>Use tools to break the compiled CSS file<\/h3>\n<p>There are <a href=\"https:\/\/github.com\/zweilove\/css_splitter\">projects<\/a> that try to address the problem of long CSS files using a CSS parser to count the number of styles and generating multiple files when necessary. It is another solution to be aware of, but if you have a well organized CSS structure and guidelines to keep them clean, you can achieve the same result without adding another dependency or step in your asset pipeline.<\/p>\n<h3>Ways to detect the number of styles<\/h3>\n<p>From the command line<\/p>\n<pre lang=\"bash\">\n$ curl --silent <url> | grep -o '{' | wc -l\n<\/pre>\n<p>or if dealing with a compressed asset<\/p>\n<pre lang=\"bash\">\n$ curl --silent -H 'Accept-encoding: gzip' <url> | \\\n> gunzip - | grep -o '{' | wc -l\n<\/pre>\n<p>For example:<\/p>\n<pre lang=\"bash\">\n$ curl --silent http:\/\/plataformatec.com.br\/stylesheets\/all.css | \\\n> grep -o '{' | wc -l\n339\n<\/pre>\n<p>Another easy way is just opening the CSS file in your browser and search for <code>{<\/code>.<\/p>\n<p>Note that if you want to check the resulting CSS file in development you need to enable assets concatenation. One options is to set <code>config.assets.debug<\/code> to false in your <code>development.rb<\/code> file.<\/p>\n<h3>Summary<\/h3>\n<p>Preprocessors help a lot but it also requires discipline like any other code that you write. If you need inspiration to organize your files, you can take a look on <a href=\"http:\/\/bourbon.io\/\">Bourbon<\/a> and even the well known <a href=\"https:\/\/github.com\/twbs\/bootstrap\/tree\/master\/less\">Bootstrap<\/a> project.<\/p>\n<p><em>Do you know any other cases where a well structured CSS saved you?<\/em><\/p>\n<p style=\"text-align: center;\">\n<p><span id=\"hs-cta-wrapper-2aeae558-5b72-4df3-bf32-e1119f34d85e\" class=\"hs-cta-wrapper\"><span id=\"hs-cta-2aeae558-5b72-4df3-bf32-e1119f34d85e\" class=\"hs-cta-node hs-cta-2aeae558-5b72-4df3-bf32-e1119f34d85e\"> <a href=\"http:\/\/cta-redirect.hubspot.com\/cta\/redirect\/378213\/2aeae558-5b72-4df3-bf32-e1119f34d85e\"><img decoding=\"async\" id=\"hs-cta-img-2aeae558-5b72-4df3-bf32-e1119f34d85e\" class=\"hs-cta-img aligncenter\" style=\"border-width: 0px;\" src=\"https:\/\/no-cache.hubspot.com\/cta\/default\/378213\/2aeae558-5b72-4df3-bf32-e1119f34d85e.png\" alt=\"\" \/><\/a><\/span><\/span><br \/>\n<!-- end HubSpot Call-to-Action Code --><\/p>\n","protected":false},"excerpt":{"rendered":"<p>CSS preprocessors like SASS and LESS improved the way we write CSS nowadays. It provides better ways to organize styles into files, that can represent a component or page, and then compile into a single file, following the idea of reducing HTTP requests. Also there are other features like variables, mixins and placeholders that help &#8230; <a class=\"read-more-link\" href=\"http:\/\/blog.plataformatec.com.br\/2014\/09\/splitting-long-css-files-to-overcome-ie9-4095-rules-limit\/\">\u00bb<\/a><\/p>\n","protected":false},"author":9,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"ngg_post_thumbnail":0,"footnotes":""},"categories":[1],"tags":[220,189],"aioseo_notices":[],"jetpack_sharing_enabled":true,"jetpack_featured_media_url":"","_links":{"self":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/4197"}],"collection":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/users\/9"}],"replies":[{"embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/comments?post=4197"}],"version-history":[{"count":13,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/4197\/revisions"}],"predecessor-version":[{"id":4212,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/4197\/revisions\/4212"}],"wp:attachment":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/media?parent=4197"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/categories?post=4197"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/tags?post=4197"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}