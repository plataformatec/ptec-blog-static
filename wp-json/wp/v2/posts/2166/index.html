{"id":2166,"date":"2011-06-16T16:22:38","date_gmt":"2011-06-16T19:22:38","guid":{"rendered":"http:\/\/blog.plataformatec.com.br\/?p=2166"},"modified":"2011-06-16T16:22:38","modified_gmt":"2011-06-16T19:22:38","slug":"multipart-templates-with-markerb","status":"publish","type":"post","link":"https:\/\/blog.plataformatec.com.br\/2011\/06\/multipart-templates-with-markerb\/","title":{"rendered":"Multipart templates with Markerb"},"content":{"rendered":"<p>When writing <a href=\"http:\/\/pragprog.com\/titles\/jvrails\/crafting-rails-applications\">Crafting Rails Applications<\/a>, I knew exactly which parts from Rails I wanted to talk about. However, I didn&#8217;t want the book to simply describe how everything works, I actually wanted everyone to build something useful from each part of Rails.<\/p>\n<p>One of the hardest areas to come up with an useful tool as example was the template handlers. Template handlers are responsible for template compilation and the canonical examples are: ERb and Haml. Obviously, creating something like ERb or Haml from scratch would require a lot of code beyond the Rails integration so it wasn&#8217;t an option. On the other hand, tools that simply render rdoc or markdown templates would be too simple and there are already plenty of gems doing the same out there.<\/p>\n<p>So I started playing with some options. The first one was something like <a href=\"https:\/\/github.com\/markaby\/markaby\" target=\"_blank\">Why&#8217;s Markaby<\/a> but that would still require a good amount of code (albeit much less than ERb). Next, <a href=\"https:\/\/gist.github.com\/336544\" target=\"_blank\">I have played with something called YERb (YAML + ERb)<\/a> which was an interesting hack but too slow to be of any use. I was almost planning to remove the chapter about template handlers when it finally came to me the idea of <strong>markerb<\/strong>: markdown + erb (in the book, we did a wordplay and called <strong>merb<\/strong>). While the idea was simple and easy to implement, it had a great use case: multipart templates.<\/p>\n<p>With <strong>Markerb<\/strong>, you can create one template for <strong>ActionMailer<\/strong> and it will be delivered both as text and HTML. So there is no need to maintain two templates. You write it in markdown, which is delivered as text, but also rendered to be delivered as HTML. Recently, <a href=\"https:\/\/github.com\/plataformatec\/markerb\">I have crafted Markerb in its own gem so everyone can use it<\/a>.<\/p>\n<h3>How to use?<\/h3>\n<p>The usage is quite simple. Assuming you have a notifier as below:<\/p>\n<pre lang=\"ruby\">class Notifier < ActionMailer::Base\r\n  def contact(recipient)\r\n    @recipient = recipient\r\n    mail(:to => @recipient, :from => \"john.doe@example.com\") do |format|\r\n      format.text\r\n      format.html\r\n    end\r\n  end\r\nend<\/pre>\n<p>If you create a template at <code>app\/views\/notifier\/contact.markerb<\/code>:<\/p>\n<pre lang=\"html_rails\">Multipart templates **rock**, right <%= @recipient %>?!<\/pre>\n<p>It will generate two parts, one in text and another in HTML when delivered. And that is it! Before we finish, here are a few things you might need to know:<\/p>\n<ul>\n<li>The &#8220;contact.markerb&#8221; template should not have a format in its name. Adding a format would make it unavailable to be rendered in different formats;\n<\/li>\n<li>The order of the parts matter. It is important for e-mail clients that you call <code>format.text<\/code> before you call <code>format.html<\/code>;<\/li>\n<li>Notice you can normally use ERb inside the template.<\/li>\n<\/ul>\n<p>If you are interested in how Markerb, template handlers and other part of Rails work, check out <a href=\"http:\/\/pragprog.com\/titles\/jvrails\/crafting-rails-applications\">Crafting Rails Applications<\/a>. We also hope to add a generator to Devise that will optionally copy all views as Markerb templates to your application.<\/p>\n<p>And you? Do you have any use cases for <a href=\"https:\/\/github.com\/plataformatec\/markerb\">Markerb<\/a>? Do you have any other interesting template handlers you would like to share?<\/p>\n","protected":false},"excerpt":{"rendered":"<p>When writing Crafting Rails Applications, I knew exactly which parts from Rails I wanted to talk about. However, I didn&#8217;t want the book to simply describe how everything works, I actually wanted everyone to build something useful from each part of Rails. One of the hardest areas to come up with an useful tool as &#8230; <a class=\"read-more-link\" href=\"https:\/\/blog.plataformatec.com.br\/2011\/06\/multipart-templates-with-markerb\/\">\u00bb<\/a><\/p>\n","protected":false},"author":4,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"ngg_post_thumbnail":0,"footnotes":""},"categories":[1],"tags":[126,155,7],"aioseo_notices":[],"jetpack_sharing_enabled":true,"jetpack_featured_media_url":"","_links":{"self":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/2166"}],"collection":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/users\/4"}],"replies":[{"embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/comments?post=2166"}],"version-history":[{"count":3,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/2166\/revisions"}],"predecessor-version":[{"id":2169,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/2166\/revisions\/2169"}],"wp:attachment":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/media?parent=2166"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/categories?post=2166"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/tags?post=2166"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}