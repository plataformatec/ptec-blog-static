{"id":4102,"date":"2014-07-01T09:00:24","date_gmt":"2014-07-01T12:00:24","guid":{"rendered":"http:\/\/blog.plataformatec.com.br\/?p=4102"},"modified":"2014-07-01T11:31:03","modified_gmt":"2014-07-01T14:31:03","slug":"ruby-blocks-precedence","status":"publish","type":"post","link":"http:\/\/blog.plataformatec.com.br\/2014\/07\/ruby-blocks-precedence\/","title":{"rendered":"Ruby blocks precedence"},"content":{"rendered":"<p>When we start programming with Ruby, one of the first niceties we learn about are the Ruby blocks. In the beginning it&#8217;s easy to get tricked by the two existing forms of blocks and when to use each:<\/p>\n<pre lang=\"ruby\">\n%w(a b c).each { |char| puts char }\n%w(a b c).each do |char| puts char end\n<\/pre>\n<p>The Ruby Community has sort of created a &#8220;guideline&#8221; for when to use one versus another: for short or inline blocks, use curly brackets <code>{..}<\/code>, for longer or multiline blocks, use the <code>do..end<\/code> format. But did you know there is actually a slight difference between them? So sit tight, we&#8217;ll cover it now.<\/p>\n<h2>Operators Precedence<\/h2>\n<p>Languages contain operators, and these operators must obey a precedence rule so that the interpreter knows the order of execution, which means one operator will be executed first if it has higher precedence than others in a piece of code. Consider the following example:<\/p>\n<pre lang=\"ruby\">\na || b && c\n<\/pre>\n<p>What operation gets executed first, <code>a || b<\/code>, or <code>b &amp;&amp; c<\/code>? This is where operator precedence takes action. In this case, the code is the same as this:<\/p>\n<pre lang=\"ruby\">\na || (b && c)\n<\/pre>\n<p>Which means <code>&amp;&amp;<\/code> has higher precedence than <code>||<\/code> in Ruby. However, if you want the condition <code>a || b<\/code> to be evaluated first, you can enforce it with the use of <code>()<\/code>:<\/p>\n<pre lang=\"ruby\">\n(a || b) && c\n<\/pre>\n<p>This way you are explicitly telling the interpreter that the condition inside the <code>()<\/code> should be executed first.<\/p>\n<h2>What about blocks?<\/h2>\n<p>It turns out blocks have precedence too! Lets see an example that mimics the Rails router with the <a href=\"http:\/\/api.rubyonrails.org\/classes\/ActionDispatch\/Routing\/Redirection.html#method-i-redirect\"><code>redirect<\/code><\/a> method:<\/p>\n<pre lang=\"ruby\">\ndef get(path, options = {}, &block)\n  puts \"get received block? #{block_given?}\"\nend\n\ndef redirect(&block)\n  puts \"redirect received block? #{block_given?}\"\nend\n\nputs '=> brackets { }'\nget 'eggs', to: redirect { 'eggs and bacon' }\n\nputs\n\nputs '=> do..end'\nget 'eggs', to: redirect do 'eggs and bacon' end\n<\/pre>\n<p>This example shows a rather common code in Rails apps: a <code>get<\/code> route that redirects to some other route in the app (some arguments from the real <code>redirect<\/code> block were omitted for clarity). And all these methods do is outputting whether they received a block or not.<\/p>\n<p>At a glance these two calls to <code>get + redirect<\/code> could be considered exact the same, however they behave differently because of the blocks precedence. Can you guess what&#8217;s the output? Take a look:<\/p>\n<pre lang=\"bash\">\n=> brackets {..}\nredirect received block? true\nget received block? false\n\n=> do..end\nredirect received block? false\nget received block? true\n<\/pre>\n<p>The curly brackets have higher precedence than the <code>do..end<\/code>, which means the block with <code>{..}<\/code> will attach to the inner method, in this example <code>redirect<\/code>, whereas the <code>do..end<\/code> will attach to the outer method, <code>get<\/code>.<\/p>\n<h2>Wrapping up<\/h2>\n<p>This blog post originated from a <a href=\"https:\/\/github.com\/rails\/rails\/issues\/8160\">real Rails issue<\/a>, where you can read a little bit more about the subject and see that even Rails got it wrong in its documentation (which is now fixed). The precedence is a subtle but important difference between <code>{..}<\/code> and <code>do..end<\/code> blocks, so be careful not to be caught off guard by it.<\/p>\n<p><em>Do you know any other interesting fact about Ruby blocks that people may not be aware of? Or maybe you learned something tricky about Ruby recently? Please share it on the comments section, we would love to hear.<\/em><\/p>\n<p style=\"text-align: center;\">\n<p><span id=\"hs-cta-wrapper-2aeae558-5b72-4df3-bf32-e1119f34d85e\" class=\"hs-cta-wrapper\"><span id=\"hs-cta-2aeae558-5b72-4df3-bf32-e1119f34d85e\" class=\"hs-cta-node hs-cta-2aeae558-5b72-4df3-bf32-e1119f34d85e\"> <a href=\"http:\/\/cta-redirect.hubspot.com\/cta\/redirect\/378213\/2aeae558-5b72-4df3-bf32-e1119f34d85e\"><img decoding=\"async\" id=\"hs-cta-img-2aeae558-5b72-4df3-bf32-e1119f34d85e\" class=\"hs-cta-img aligncenter\" style=\"border-width: 0px;\" src=\"https:\/\/no-cache.hubspot.com\/cta\/default\/378213\/2aeae558-5b72-4df3-bf32-e1119f34d85e.png\" alt=\"\" \/><\/a><\/span><\/span><br \/>\n<!-- end HubSpot Call-to-Action Code --><\/p>\n","protected":false},"excerpt":{"rendered":"<p>When we start programming with Ruby, one of the first niceties we learn about are the Ruby blocks. In the beginning it&#8217;s easy to get tricked by the two existing forms of blocks and when to use each: %w(a b c).each { |char| puts char } %w(a b c).each do |char| puts char end The &#8230; <a class=\"read-more-link\" href=\"http:\/\/blog.plataformatec.com.br\/2014\/07\/ruby-blocks-precedence\/\">\u00bb<\/a><\/p>\n","protected":false},"author":7,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"ngg_post_thumbnail":0,"footnotes":""},"categories":[1],"tags":[185,60],"aioseo_notices":[],"jetpack_sharing_enabled":true,"jetpack_featured_media_url":"","_links":{"self":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/4102"}],"collection":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/users\/7"}],"replies":[{"embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/comments?post=4102"}],"version-history":[{"count":8,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/4102\/revisions"}],"predecessor-version":[{"id":4106,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/4102\/revisions\/4106"}],"wp:attachment":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/media?parent=4102"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/categories?post=4102"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/tags?post=4102"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}