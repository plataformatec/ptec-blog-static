{"id":5397,"date":"2016-05-12T17:02:42","date_gmt":"2016-05-12T20:02:42","guid":{"rendered":"http:\/\/blog.plataformatec.com.br\/?p=5397"},"modified":"2016-05-12T17:08:54","modified_gmt":"2016-05-12T20:08:54","slug":"keeping-your-ruby-on-rails-app-easy-to-update","status":"publish","type":"post","link":"http:\/\/blog.plataformatec.com.br\/2016\/05\/keeping-your-ruby-on-rails-app-easy-to-update\/","title":{"rendered":"Keeping your Ruby on Rails app easy to update"},"content":{"rendered":"<p><a href=\"http:\/\/weblog.rubyonrails.org\/2016\/5\/6\/this-week-in-rails-railsconf-recap-rails-5-0-rc-1-is-out\/\">The Rails 5 release candidate is out<\/a>, bringing new improvements that will make your life as a developer easier. Probably you are excited to update your application to the new major Rails release, but you may have some concerns. It is normal, updating your application to fit the new version may bring an unknown number of changes to work. On this blog post, I&#8217;ll give you some tips to keep the workload of updating at a minimum.<\/p>\n<p>You can try the new Rails version using the <a href=\"http:\/\/edgeguides.rubyonrails.org\/upgrading_ruby_on_rails.html#upgrading-from-rails-4-2-to-rails-5-0\">published guides<\/a> and report any problem you may find on <a href=\"https:\/\/github.com\/rails\/rails\/milestones\/5.0.0\">Rails issue tracker<\/a>.<\/p>\n<h2>Why update?<\/h2>\n<p>I think it is an important question you may need to answer to your team members. My favorite reasons are: <strong>security<\/strong>, <strong>bug fixes<\/strong>, and <strong>features<\/strong>.<\/p>\n<p>Rails has supported versions to receive security fix releases. If you are in a version not supported, you may be vulnerable. You should read the <a href=\"http:\/\/rubyonrails.org\/security\">security policies<\/a> and check if your app is using the supported versions.<\/p>\n<p>The framework also has <a href=\"http:\/\/rubyonrails.org\/maintenance\/\">maintenance policies<\/a> that you should be aware of. Performance improvements and bug fixes you may miss if your app is too old. You need to code by yourself and do workarounds to have the same benefits, a code that would be more reliable being inside the framework.<\/p>\n<p>We usually hear developers complaining about applications that use old versions of the framework. The reason is new versions of the tool usually bring improvements to make the developer&#8217;s life easier. In the developer&#8217;s perspective, it&#8217;s demotivating knowing there&#8217;s a robust, elegant and productive way to do things and they are not able to use it.<\/p>\n<p>Keeping your Rails up to date will help your code base health and also can be a factor of motivation for your team.<\/p>\n<h2>What I should do?<\/h2>\n<p>We have been maintaining and evolving several old Rails apps in different contexts for years, and we have seen some practices that make it easier to keep your app updated:<\/p>\n<ul>\n<li>strict use of gems<\/li>\n<li>avoid monkey patches<\/li>\n<li>keep a good test coverage<\/li>\n<\/ul>\n<h3>Gems<\/h3>\n<p>Adding new dependencies using RubyGems and bundler is awesome, but overusing gems can not only slow your app down but slow you with the amount of work you need to update your Rails version. Some gems are coupled to the framework when you update it. These gems may break. When they break, you need to update them together.<\/p>\n<p>I recommend you considering these points before putting a new gem in your Gemfile:<\/p>\n<ul>\n<li><strong>Is this gem adding great value to your project?<\/strong> Some gems increase your app security, solve complex problems and reduce a lot of worktimes. Other gems add less value and can easily be replaced with your own implementation. Sometimes, it\u2019s worth doing your own implementation than depending on a third\u00adparty code.<\/p>\n<\/li>\n<li>\n<p><strong>Is this gem well maintained?<\/strong> It\u2019s good checking if the commits are recent, the project is well documented, the changelog contains helpful messages between releases, the maintainers often close issues and answer them respectfully. These are good signs that the gem you are adding won&#8217;t give you trouble in the future.<\/p>\n<\/li>\n<\/ul>\n<p>Adding a gem to your project is adding a coupling. Software coupling has its downsides, for example, the ripple effect of changes. The downside of more work to update your dependencies will be worth it if you accurately added them. If you want to learn more about downsides of dependencies, you can read this <a href=\"https:\/\/www.mikeperham.com\/2016\/02\/09\/kill-your-dependencies\/\">blog post about Ruby dependencies<\/a> and <a href=\"http:\/\/www.haneycodes.net\/npm-left-pad-have-we-forgotten-how-to-program\/\">this one about Node<\/a>.<\/p>\n<h3>Avoid monkey patches<\/h3>\n<p>Monkey patches are often used to change the behavior of the code you don&#8217;t own. For example, rewriting or adding Ruby standard library classes or methods to fit your application needs. Careless monkey patches can bring you serious problems while updating Rails.<\/p>\n<p>Adding code that changes the behavior of gem classes can result in hidden bugs and turn any upgrade into a painful experience. It&#8217;s often uncertain how many objects are depending on your change and predicting all the effects of the monkey patched method. For example, in a new version of the gem, your monkey patch can change a method that was updated or doesn\u2019t even exist anymore.<\/p>\n<p>We have seen some monkey patches that are a gem fix or enhancement. These changes may benefit others users of the gem and were hidden in application code. You may get in touch with gem maintainers and propose your changes. If your contribution is accepted, your fix will have a solid and proper place to be.<\/p>\n<p>If your behavior is specific for your app, you should consider extending the gem and applying your wanted behavior using the conventional OO practices. For example, you can create an adapter class, subclass or composition. You may also take a look at <a href=\"http:\/\/blog.honeybadger.io\/understanding-ruby-refinements-and-lexical-scope\/\">Ruby Refinements<\/a>. Using this structure, you can create scoped changes that must be used explicitly. Explicit code reduces costs to maintain the app and the effort of updating to a new Rails version.<\/p>\n<p>After checking all previous solutions and you still think that a monkey patch better suits your needs, you should know there are <a href=\"http:\/\/www.justinweiss.com\/articles\/3-ways-to-monkey-patch-without-making-a-mess\/\">organized ways of adding them<\/a>. Regardless of coding, I recommend you to add a great documentation to keep it sane for your teammates and your future self. In this documentation, you should describe why it is necessary, when it can be removed and how it can be removed. It will help a better understanding of the app and provide useful information while updating your Rails app.<\/p>\n<h3>Keep a good test coverage<\/h3>\n<p>We all need to pay special attention to the tests. Some changes while updating Rails will be required and having a trustful test suite will help you discover problems before deploying your app to your end users.<\/p>\n<p>Having 100% of test coverage is <a href=\"http:\/\/martinfowler.com\/bliki\/TestCoverage.html\">no guarantee of testing the correct behavior<\/a>. I would say the team should have a test coverage that they feel confident about.<\/p>\n<p>Some symptoms that your application doesn\u2019t have good coverage is when recurrent errors are found while the application is running and all your automated tests are passing. You may use a tool like <a href=\"https:\/\/github.com\/colszowka\/simplecov\">simplecov<\/a> to check your coverage rate, having a very low coverage is a bad sign.<\/p>\n<p>Adding proper tests is the only solution for low test coverage. If you are in this situation, you should start adding tests focused on the most used and important features. Having a good test coverage is essential to evolve because its main purpose is providing fast feedback that previously working features are still working.<\/p>\n<h2>Conclusion<\/h2>\n<p>Keeping the application\u2019s Rails version updated is a responsibility that should not be ignored since it brings improvements for your team and security for your users.<\/p>\n<p>I hope these tips help you keep your code easy to update.<\/p>\n<p>Do you have more tips? Please leave comments below and tell us about your experience to keep your application up to date.<\/p>\n<div style=\"padding: 40px 0 60px\"><a href=\"http:\/\/blog.plataformatec.com.br\/subscribe\/\"><img decoding=\"async\" style=\"border: none\" src=\"http:\/\/blog.plataformatec.com.br\/wp-content\/uploads\/2016\/03\/CTA-subscribe-blog-1.png\" alt=\"Subscribe to our blog\" \/><\/a><\/div>\n","protected":false},"excerpt":{"rendered":"<p>The Rails 5 release candidate is out, bringing new improvements that will make your life as a developer easier. Probably you are excited to update your application to the new major Rails release, but you may have some concerns. It is normal, updating your application to fit the new version may bring an unknown number &#8230; <a class=\"read-more-link\" href=\"http:\/\/blog.plataformatec.com.br\/2016\/05\/keeping-your-ruby-on-rails-app-easy-to-update\/\">\u00bb<\/a><\/p>\n","protected":false},"author":31,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"ngg_post_thumbnail":0,"footnotes":""},"categories":[1],"tags":[7,248,60],"aioseo_notices":[],"jetpack_sharing_enabled":true,"jetpack_featured_media_url":"","_links":{"self":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/5397"}],"collection":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/users\/31"}],"replies":[{"embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/comments?post=5397"}],"version-history":[{"count":18,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/5397\/revisions"}],"predecessor-version":[{"id":5488,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/5397\/revisions\/5488"}],"wp:attachment":[{"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/media?parent=5397"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/categories?post=5397"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/tags?post=5397"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}