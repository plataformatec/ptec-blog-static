{"id":2841,"date":"2012-06-20T11:53:56","date_gmt":"2012-06-20T14:53:56","guid":{"rendered":"http:\/\/blog.plataformatec.com.br\/?p=2841"},"modified":"2012-08-13T17:16:25","modified_gmt":"2012-08-13T20:16:25","slug":"about-the-composed_of-removal","status":"publish","type":"post","link":"https:\/\/blog.plataformatec.com.br\/2012\/06\/about-the-composed_of-removal\/","title":{"rendered":"About the composed_of removal"},"content":{"rendered":"<h3>Update 08\/13\/2012<\/h3>\n<p>Since the new <a href=\"https:\/\/twitter.com\/rails\/status\/230724881900261378\">deprecation policy<\/a> the <code>composed_of<\/code> removal was reverted. We are still discussing the future of this feature.<\/p>\n<h3>The reason<\/h3>\n<p>A few days ago we started a discussion about the <a href=\"https:\/\/github.com\/rails\/rails\/pull\/6743\">removal of the <code>composed_of<\/code><\/a> method from Active Record. I started this discussion because when I was tagging every Rails issue according to its framework, I found <a href=\"https:\/\/github.com\/rails\/rails\/issues\/1513\">some<\/a> of <a href=\"https:\/\/github.com\/rails\/rails\/pull\/3807\">them<\/a> <a href=\"https:\/\/github.com\/rails\/rails\/pull\/1436\">related<\/a> to <a href=\"https:\/\/github.com\/rails\/rails\/issues\/2084\"><code>composed_of<\/code><\/a>, that are not only hard to fix but would add more complexity for a feature that, in my opinion, is not adding any visible value to the framework.<\/p>\n<p><a href=\"http:\/\/confreaks.com\/videos\/880-railsconf2012-keynote-i-ve-made-a-huge-mistake\">In this presentation<\/a>, <a href=\"https:\/\/twitter.com\/tenderlove\">Aaron Patterson<\/a> talks about three types of features: Cosmetic, Refactoring, and Course Correction. Aaron defines cosmetic features as a feature that adds dubious value and unknown debt (I highly recommend that you watch the whole presentation to see more about these types of features). This is exactly what I think about <code>composed_of<\/code>. At this time this feature is adding more debt than value to the Rails code base and applications, so the Rails team have decided to remove this method.<\/p>\n<h3>The plan<\/h3>\n<p>The removal plan is simple, deprecate in 3.2 and remove in 4.0. This means that you need to stop using this feature and implement it in another way.<\/p>\n<p>The Rails team have chosen this path because this feature can be implemented using plain ruby methods for getters and setters. You will see how in the next section.<\/p>\n<h3>Implementation<\/h3>\n<p>In the simplest case, when you have only one attribute and needs to instantiate an object with the value of this attribute, you can use the <code>serialize<\/code> feature with a custom serializer:<\/p>\n<pre lang=\"ruby\">\nclass MoneySerializer\n  def dump(money)\n    money.value\n  end\n\n  def load(value)\n    Money.new(value)\n  end\nend\n\nclass Account < ActiveRecord::Base\n  serialize :balance, MoneySerializer.new\nend\n<\/pre>\n<p>To use it with multiple attributes you can do the following:<\/p>\n<pre lang=\"ruby\">\nclass Person < ActiveRecord::Base\n  def address\n    @address ||= Address.new(address_street, address_city)\n  end\n\n  def address=(address)\n    self[:address_street] = address.street\n    self[:address_city]   = address.city\n    \n    @address = address\n  end\nend\n<\/pre>\n<h3>Benefits for Rails developers<\/h3>\n<p>I already talked about what this removal can provide to Rails maintainers, but what benefits does it bring to Rails developers?<\/p>\n<p>I think that the best advantages are:<\/p>\n<ul>\n<li>It is easier to test the composite objects;<\/li>\n<li>It is easier to understand the lazy methods;<\/li>\n<li>It is easier to customize it without resorting to options like <code>:converter<\/code>, <code>:constructor<\/code> and <code>:allow_nil<\/code>.<\/li>\n<\/ul>\n<h3>Wrapping up<\/h3>\n<p>I strongly recommend that you read the whole discussion in the <a href=\"https:\/\/github.com\/rails\/rails\/pull\/6743\">pull request<\/a>. You will find more examples and additional information there.<\/p>\n<p>Also, I want to thank <a href=\"https:\/\/twitter.com\/steveklabnik\">@steveklabnik<\/a> for working on this feature and the awesome work that he has been doing on the Rails Issues Team.<\/p>\n<p>Finally, I want to invite you to help the Rails team to fix, test, and track issues. About half of the issues are related to the Active Record framework and we need to work on them. As a regular Rails contributor and Rails developer, I think there is still a lot we can do to improve the Rails code base, so join us.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>In this post we talk about the motivation of the composed_of removal in the Rails 4.0 and the possible replacements<\/p>\n","protected":false},"author":15,"featured_media":0,"comment_status":"open","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"ngg_post_thumbnail":0,"footnotes":""},"categories":[1],"tags":[106,184,176],"aioseo_notices":[],"jetpack_sharing_enabled":true,"jetpack_featured_media_url":"","_links":{"self":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/2841"}],"collection":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/users\/15"}],"replies":[{"embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/comments?post=2841"}],"version-history":[{"count":73,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/2841\/revisions"}],"predecessor-version":[{"id":3041,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/2841\/revisions\/3041"}],"wp:attachment":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/media?parent=2841"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/categories?post=2841"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/tags?post=2841"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}