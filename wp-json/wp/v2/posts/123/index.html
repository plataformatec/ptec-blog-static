{"id":123,"date":"2009-08-31T11:02:15","date_gmt":"2009-08-31T14:02:15","guid":{"rendered":"http:\/\/blog.plataformatec.com.br\/?p=123"},"modified":"2011-04-08T09:57:02","modified_gmt":"2011-04-08T12:57:02","slug":"do-not-burden-your-users-with-validations","status":"publish","type":"post","link":"https:\/\/blog.plataformatec.com.br\/2009\/08\/do-not-burden-your-users-with-validations\/","title":{"rendered":"Do not burden your users with validations"},"content":{"rendered":"<p>One of the first things we learn in Rails which are greatly useful are <a href=\"http:\/\/api.rubyonrails.org\/classes\/ActiveRecord\/Validations\/ClassMethods.html\" target=\"_blank\" >ActiveRecord validations<\/a>. However, since they are easy to add, it happens frequently that we are burdening our users with validations instead of making forms easier and clearer.<\/p>\n<p>For instance, let&#8217;s suppose we are validating the <a href=\"http:\/\/en.wikipedia.org\/wiki\/Social_Security_number\" target=\"_blank\">Social Security Number (SSN)<\/a> of an user on signup. A sample code would be:<\/p>\n<pre lang=\"ruby\" line=\"1\">\r\nclass User < ActiveRecord::Base\r\n  validates_presence_of :ssn\r\n  validates_length_of :ssn, :is => 9\r\n  validates_numericality_of :ssn\r\n  validates_uniqueness_of :ssn\r\n  validates_as_ssn :ssn # Checks if a reserved or special SSN was sent\r\nend\r\n<\/pre>\n<p>With the configuration above, if the user forgets to fill in the SSN, leaving it blank, <strong>four error messages<\/strong> related to the SSN field will be shown:<\/p>\n<ul>\n<li> SSN can&#8217;t be blank<\/li>\n<li> SSN is the wrong length (should be 9 characters)<\/li>\n<li> SSN is not a number<\/li>\n<li> SSN is invalid<\/li>\n<\/ul>\n<p>The question is: if the user just left the field blank, why we should show all those errors to him? Are they all relevant?<\/p>\n<div id=\"attachment_105\" style=\"width: 410px\" class=\"wp-caption aligncenter\"><img loading=\"lazy\" decoding=\"async\" aria-describedby=\"caption-attachment-105\" class=\"size-full wp-image-105\" title=\"Sad Cat\" src=\"http:\/\/blog.plataformatec.com.br\/wp-content\/uploads\/2009\/08\/funny-pictures-sad-cat-blackandwhit.jpg\" alt=\"OMG! What have I done wrong to appear so many errors?\" width=\"300\" height=\"233\" \/><p id=\"caption-attachment-105\" class=\"wp-caption-text\">OMG! What have I done wrong to appear so many errors?<\/p><\/div>\n<p>Luckily, the solution is quite simple: we can make use of the <em>:allow_blank<\/em> option, so other validations won&#8217;t be triggered if the field is blank:<\/p>\n<pre lang=\"ruby\" line=\"1\">\r\nclass User < ActiveRecord::Base\r\n  validates_presence_of :ssn\r\n  validates_length_of :ssn, :is => 11, :allow_blank => true\r\n  validates_numericality_of :ssn, :allow_blank => true\r\n  validates_uniqueness_of :ssn, :allow_blank => true\r\n  validates_as_ssn :ssn, :allow_blank => true\r\nend\r\n<\/pre>\n<p>This is also a nice use case for the <strong>Object#with_options<\/strong> method added by Rails:<\/p>\n<pre lang=\"ruby\" line=\"1\">\r\nclass User < ActiveRecord::Base\r\n  validates_presence_of :ssn\r\n\r\n  with_options :allow_blank => true do |v|\r\n    v.validates_length_of :ssn, :is => 11\r\n    v.validates_numericality_of :ssn\r\n    v.validates_uniqueness_of :ssn\r\n    v.validates_as_ssn :ssn\r\n  end\r\nend\r\n<\/pre>\n<p>SSN is just an example, but we are frequently burdening our users in username, e-mail, password and many other fields.<\/p>\n<h3>Do not validate presence of confirmation fields<\/h3>\n<p>Another interesting subject about validations are the confirmation fields. We have the following note in the documentation of <em>validates_confirmation_of<\/em>:<\/p>\n<pre lang=\"ruby\" line=\"1\">\r\nvalidates_confirmation_of :password\r\n# NOTE: This check is performed only if password_confirmation is not nil\r\n<\/pre>\n<p>And this is a <strong>feature<\/strong>. This means that you don&#8217;t need to give the <em>:password_confirmation<\/em> key when creating objects in console or when writing tests:<\/p>\n<pre lang=\"ruby\" line=\"1\">\r\nit \"should be valid with valid attributes\" do\r\n  User.new(:password => \"123456\").should be_valid\r\nend\r\n<\/pre>\n<p>If the test fails, you are validating the presence of  <em>:password_confirmation<\/em>, which is unnecessary.  Since the <em>:password_confirmation<\/em> field will be available in the views, it will always be sent. So if the user leave it blank, it&#8217;s sent as blank value to the model and therefore will be checked. Just in the place it needs to be.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>One of the first things we learn in Rails which are greatly useful are ActiveRecord validations. However, since they are easy to add, it happens frequently that we are burdening our users with validations instead of making forms easier and clearer. For instance, let&#8217;s suppose we are validating the Social Security Number (SSN) of an &#8230; <a class=\"read-more-link\" href=\"https:\/\/blog.plataformatec.com.br\/2009\/08\/do-not-burden-your-users-with-validations\/\">\u00bb<\/a><\/p>\n","protected":false},"author":5,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"ngg_post_thumbnail":0,"footnotes":""},"categories":[1],"tags":[7,21,20],"aioseo_notices":[],"jetpack_sharing_enabled":true,"jetpack_featured_media_url":"","_links":{"self":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/123"}],"collection":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/users\/5"}],"replies":[{"embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/comments?post=123"}],"version-history":[{"count":8,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/123\/revisions"}],"predecessor-version":[{"id":1982,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/posts\/123\/revisions\/1982"}],"wp:attachment":[{"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/media?parent=123"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/categories?post=123"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/blog.plataformatec.com.br\/wp-json\/wp\/v2\/tags?post=123"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}