<!DOCTYPE html>
<html dir="ltr" lang="en-US" prefix="og: https://ogp.me/ns#">
<head>
  <meta charset="utf-8">
  <meta name="bitly-verification" content="b3acd9a47f4e">

  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="emoji:root" content="/wp-content/themes/ptec">
  <meta name="theme-color" content="#cacaca">
  
    <meta name="bitly-verification" content="b3acd9a47f4e">
  <meta property="og:image" content="/wp-content/themes/ptec/assets/opengraph.png">
  <link rel="icon" sizes="192x192" href="/wp-content/themes/ptec/assets/icons/chrome-192x.png">
  <link rel="pingback" href="/xmlrpc.php">
  
		<!-- All in One SEO 4.5.4 - aioseo.com -->
		<title>Building a new MySQL adapter for Ecto, Part I: Hello World « Plataformatec Blog</title>
		<meta name="description" content="As you may have seen in the announcement, Plataformatec is working on a new MySQL driver called MyXQL. Writing a complete driver involves quite a bit of work. To name just a few things, we need to support: all protocol messages and data types, authentication schemes, connection options (TCP/SSL/UNIX domain socket), transactions and more. Rather">
		<meta name="robots" content="max-image-preview:large">
		<link rel="canonical" href="/2018/11/building-a-new-mysql-adapter-for-ecto-part-i-hello-world/">
		<meta name="generator" content="All in One SEO (AIOSEO) 4.5.4">
		<meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="Plataformatec Blog | Plataformatec&#039;s place to talk about Ruby, Ruby on Rails, Elixir, and software engineering">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Building a new MySQL adapter for Ecto, Part I: Hello World « Plataformatec Blog">
		<meta property="og:description" content="As you may have seen in the announcement, Plataformatec is working on a new MySQL driver called MyXQL. Writing a complete driver involves quite a bit of work. To name just a few things, we need to support: all protocol messages and data types, authentication schemes, connection options (TCP/SSL/UNIX domain socket), transactions and more. Rather">
		<meta property="og:url" content="/2018/11/building-a-new-mysql-adapter-for-ecto-part-i-hello-world/">
		<meta property="article:published_time" content="2018-11-14T13:16:32+00:00">
		<meta property="article:modified_time" content="2019-01-04T20:07:55+00:00">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content="Building a new MySQL adapter for Ecto, Part I: Hello World « Plataformatec Blog">
		<meta name="twitter:description" content="As you may have seen in the announcement, Plataformatec is working on a new MySQL driver called MyXQL. Writing a complete driver involves quite a bit of work. To name just a few things, we need to support: all protocol messages and data types, authentication schemes, connection options (TCP/SSL/UNIX domain socket), transactions and more. Rather">
		<meta name="google" content="nositelinkssearchbox">
		<script type="application/ld+json" class="aioseo-schema">{"@context":"https:\/\/schema.org","@graph":[{"@type":"Article","@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#article","name":"Building a new MySQL adapter for Ecto, Part I: Hello World « Plataformatec Blog","headline":"Building a new MySQL adapter for Ecto, Part I: Hello World","author":{"@id":"\/author\/wojtek-mach\/#author"},"publisher":{"@id":"\/#organization"},"image":{"@type":"ImageObject","url":"\/wp-content\/uploads\/2018\/10\/Elixir_2-1.png","@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#articleImage","width":1200,"height":250,"caption":"banner-elixir development subscription"},"datePublished":"2018-11-14T11:16:32-02:00","dateModified":"2019-01-04T18:07:55-02:00","inLanguage":"en-US","mainEntityOfPage":{"@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#webpage"},"isPartOf":{"@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#webpage"},"articleSection":"English, ecto, elixir"},{"@type":"BreadcrumbList","@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#breadcrumblist","itemListElement":[{"@type":"ListItem","@id":"\/#listItem","position":1,"name":"Home","item":"\/","nextItem":"\/2018\/#listItem"},{"@type":"ListItem","@id":"\/2018\/#listItem","position":2,"name":"2018","item":"\/2018\/","nextItem":"\/2018\/11\/#listItem","previousItem":"\/#listItem"},{"@type":"ListItem","@id":"\/2018\/11\/#listItem","position":3,"name":"November","item":"\/2018\/11\/","nextItem":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#listItem","previousItem":"\/2018\/#listItem"},{"@type":"ListItem","@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#listItem","position":4,"name":"Building a new MySQL adapter for Ecto, Part I: Hello World","previousItem":"\/2018\/11\/#listItem"}]},{"@type":"Organization","@id":"\/#organization","name":"Plataformatec Blog","url":"\/"},{"@type":"Person","@id":"\/author\/wojtek-mach\/#author","url":"\/author\/wojtek-mach\/","name":"Wojtek Mach","image":{"@type":"ImageObject","@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#authorImage","url":"https:\/\/secure.gravatar.com\/avatar\/84ef665236afa8310820dd00f1d710f8?s=96&d=mm&r=pg","width":96,"height":96,"caption":"Wojtek Mach"}},{"@type":"WebPage","@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#webpage","url":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/","name":"Building a new MySQL adapter for Ecto, Part I: Hello World « Plataformatec Blog","description":"As you may have seen in the announcement, Plataformatec is working on a new MySQL driver called MyXQL. Writing a complete driver involves quite a bit of work. To name just a few things, we need to support: all protocol messages and data types, authentication schemes, connection options (TCP\/SSL\/UNIX domain socket), transactions and more. Rather","inLanguage":"en-US","isPartOf":{"@id":"\/#website"},"breadcrumb":{"@id":"\/2018\/11\/building-a-new-mysql-adapter-for-ecto-part-i-hello-world\/#breadcrumblist"},"author":{"@id":"\/author\/wojtek-mach\/#author"},"creator":{"@id":"\/author\/wojtek-mach\/#author"},"datePublished":"2018-11-14T11:16:32-02:00","dateModified":"2019-01-04T18:07:55-02:00"},{"@type":"WebSite","@id":"\/#website","url":"\/","name":"Plataformatec Blog","description":"Plataformatec's place to talk about Ruby, Ruby on Rails, Elixir, and software engineering","inLanguage":"en-US","publisher":{"@id":"\/#organization"}}]}</script>
		<!-- All in One SEO -->


		<!-- Meta Tag Manager -->
		<meta name="twitter:label1" content="Plataformatec">
		<meta name="twitter:data1" content="Professional Consulting and Development for companies using Elixir or Ruby">
		<!-- / Meta Tag Manager -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Comments Feed" href="/comments/feed/">
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.4.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🫱🏻‍🫲🏿","🫱🏻​🫲🏿")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=6.4.2" type="text/css" media="all">
<style id="wp-block-library-inline-css" type="text/css">.has-text-align-justify{text-align:justify;}</style>
<link rel="stylesheet" id="mediaelement-css" href="/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="/wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=6.4.2" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="webfont-css" href="//fonts.googleapis.com/css?family=Bree+Serif&#038;ver=6.4.2" type="text/css" media="all">
<link rel="stylesheet" id="main-css" href="/wp-content/themes/ptec/style.css?ver=6.4.2" type="text/css" media="all">
<link rel="stylesheet" id="tablepress-default-css" href="/wp-content/plugins/tablepress/css/build/default.css?ver=2.2.4" type="text/css" media="all">
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/7933">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.4.2">
<link rel="shortlink" href="/?p=7933">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F2018%2F11%2Fbuilding-a-new-mysql-adapter-for-ecto-part-i-hello-world%2F">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F2018%2F11%2Fbuilding-a-new-mysql-adapter-for-ecto-part-i-hello-world%2F#038;format=xml">
                                                                                                                                                </head>
  <body class="post-template-default single single-post postid-7933 single-format-standard">
    <div class="site-header">
      <div class="site-header-background">
        <header class="site-header-container">
          <h1 class="site-header-logo">
            <a href="/">
              <img src="/wp-content/themes/ptec/assets/plataformatec.svg" height="70" alt="The plataformatec logo">
            </a>
          </h1>

          <form class="header-search-form" method="GET" action="/">
            <input type="search" name="s" placeholder="Search our blog..." class="header-search-input">
          </form>

          <ul class="site-nav">
            <li class="site-nav-item"><a href="http://plataformatec.com.br/services">Services</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/playbook">Playbook</a></li>
            <li class="site-nav-item handheld-hidden"><a href="http://plataformatec.com.br/forge">Forge</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/careers">Careers</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/contact">Contact</a></li>
          </ul>
        </header>
      </div>
      <nav class="header-nav">
        <input type="checkbox" id="nav-toggle-checkbox" class="header-nav-checkbox">
        <label for="nav-toggle-checkbox" class="header-nav-toggle">Topics we write about</label>

        <ul class="header-nav-list" itemscope itemtype="http://schema.org/SiteNavigationElement">
          <li class="header-nav-item header-search-nav-item">
            <form class="header-nav-search-form" method="GET" action="/">
              <input type="search" name="s" placeholder="Search our blog..." class="header-search-input">
            </form>
          </li>
                    <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/elixir" itemprop="url">Elixir</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/rails" itemprop="url">Ruby on Rails</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/devise" itemprop="url">Devise</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/simple_form" itemprop="url">Simple Form</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/agile" itemprop="url">Agile</a>
          </li>
        </ul>
      </nav>
    </div>
<div class="site-container">
  <div class="page-container">
                  <section class="post-section">
  <header class="post-header">
    <h1 class="post-title">
      <a href="/2018/11/building-a-new-mysql-adapter-for-ecto-part-i-hello-world/" rel="bookmark">Building a new MySQL adapter for Ecto, Part I: Hello World</a>
    </h1>
          <time class="post-date-ribbon" datetime="2018-11-14T11:16:32-02:00">Nov 14, 2018</time>
      <p class="post-author">
        <img alt="" src="https://secure.gravatar.com/avatar/84ef665236afa8310820dd00f1d710f8?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/84ef665236afa8310820dd00f1d710f8?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">        Written by <a href="/?author=70" title="Posts by Wojtek Mach">Wojtek Mach</a>.
      </p>
        </header>

      <article class="post-body">
      <p>As you may have seen in the <a href="https://elixirforum.com/t/announcing-a-new-mysql-driver-myxql/17124" target="_blank" rel="noopener">announcement</a>, Plataformatec is working on a new MySQL driver called MyXQL.</p>
<p>Writing a complete driver involves quite a bit of work. To name just a few things, we need to support: all protocol messages and data types, authentication schemes, connection options (TCP/SSL/UNIX domain socket), transactions and more. Rather than going through all of these in detail, I plan to distill this knowledge into 4 parts, each with a quick overview of a given area:</p>
<ul>
<li>
<a href="/2018/11/building-a-new-mysql-adapter-for-ecto-part-i-hello-world/">Part I: Hello World</a> (you&#8217;re here!)</li>
<li><a href="/2018/12/building-a-new-mysql-adapter-for-ecto-part-ii-encoding-decoding/" target="_blank" rel="noopener">Part II: Encoding/Decoding</a></li>
<li><a href="/2018/12/building-a-new-mysql-adapter-for-ecto-part-iii-dbconnection-integration/" target="_blank" rel="noopener">Part III: DBConnection Integration</a></li>
<li><a href="/2019/01/building-a-new-mysql-adapter-for-ecto-part-iv-ecto-integration/" target="_blank" rel="noopener">Part IV: Ecto Integration</a></li>
</ul>
<p>This also mimics how I approached the development of the library, my end goal was to integrate with Ecto and I wanted to be integrating end-to-end as soon and as often as possible. Rather than implementing each part fully, I implemented just enough to move forward knowing I can later go back and fill in remaining details. Without further ado, let&#8217;s get started!</p>
<h3>Hello World</h3>
<p>Our &#8220;Hello World&#8221; will involve performing a &#8220;handshake&#8221;: connecting to a running MySQL server and authenticating a user. To avoid getting bogged down in authentication details, the simplest possible thing to do is to log in as user without password. Let&#8217;s create one:</p>
<pre><code>$ mysql --user=root -e "CREATE USER myxql_test"
</code></pre>
<p>We can check if everything went well by trying to log in as that user:</p>
<pre><code>$ mysql --user=myxql_test -e "SELECT NOW()"
+---------------------+
| NOW()               |
+---------------------+
| 2018-10-04 18:35:11 |
+---------------------+
</code></pre>
<p>If you don&#8217;t have MySQL installed, I recommend setting it up via Homebrew, if you&#8217;re on macOS, or Docker. I ended up using Docker because I knew I needed to test on multiple server versions. Here&#8217;s how I set it up:</p>
<pre><code>$ docker run --publish=3306:3306 --name myxql_test -e MYSQL_ROOT_PASSWORD=secret -d mysql:8.0.12
# note we connect via TCP, instead of the default UNIX domain socket:
$ mysql --protocol=tcp --user=root --password=secret -e "CREATE USER myxql_test;"

$ mysql --protocol=tcp --user=myxql_test -e "SELECT NOW()"
+---------------------+
| NOW()               |
+---------------------+
| 2018-10-04 18:40:04 |
+---------------------+
</code></pre>
<p>We can now connect to the server from IEx session:</p>
<pre><code>iex&gt; {:ok, sock} = :gen_tcp.connect('127.0.0.1', 3306, [:binary, active: false], 5000)
{:ok, #Port&lt;0.6&gt;}
</code></pre>
<p>Let&#8217;s break this down. <a href="http://erlang.org/doc/man/gen_tcp.html#connect-4" target="_blank" rel="noopener"><code>:gen_tcp.connect/4</code></a> accepts:</p>
<ol>
<li>Hostname (as charlist)</li>
<li>Port</li>
<li>Options (as proplist); by default, data from the socket is returned as iolist, however for us binary will be more convenient to work with, so we pass <code>:binary</code> option.<br>
<code>active: false</code> means we&#8217;ll work with the socket in &#8220;passive mode&#8221;, meaning we&#8217;ll read data using blocking <a href="http://erlang.org/doc/man/gen_tcp.html#recv-3" target="_blank" rel="noopener"><code>:gen_tcp.recv/3</code></a> call.</li>
<li>Timeout (in milliseconds)</li>
</ol>
<p>Let&#8217;s now read data from the socket: (<code>0</code> means we read all available bytes, <code>5000</code> is the timeout in milliseconds)</p>
<pre><code>iex&gt; {:ok, data} = :gen_tcp.recv(sock, 0, 5000)
iex&gt; data
&lt;&lt;74, 0, 0, 0, 10, 56, 46, 48, 46, 49, 50, 0, 12, 0, 0, 0, 11, 9, 19, 27, 96, 108, 77, 116, 0, 255, 255, 255, 2, 0, 255, 195, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 37, 62, 29, 59, 1, ...&gt;&gt;
</code></pre>
<p>To make sense of this, we&#8217;re gonna need to look into MySQL manual.<br>
Each <a href="https://dev.mysql.com/doc/internals/en/mysql-packet.html" target="_blank" rel="noopener">MySQL packet</a> has 3 elements: length of the payload (3-byte integer), sequence id (1-byte integer), and payload.<br>
In this case, the actual payload is the <a href="https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake">&#8220;Initial Handshake Packet&#8221;</a>. Let&#8217;s extract the payload part using binary matching (see <a href="https://hexdocs.pm/elixir/Kernel.SpecialForms.html#%3C%3C%3E%3E/1">&lt;&lt;&gt;&gt;/1</a> for more information on binary matching):</p>
<pre><code>iex&gt; &lt;&lt;payload_length::24, sequence_id::8, payload::binary&gt;&gt; = data
iex&gt; payload_length
4849664
iex&gt; byte_size(payload)
74
</code></pre>
<p>Wait, the size of the payload is <code>74</code> so why <code>payload_length</code> is <code>4849664</code>?! Numerical values when stored in a binary have <a href="https://en.wikipedia.org/wiki/Endianness" target="_blank" rel="noopener">&#8220;endianness&#8221;</a> which basically means whether we should read bits/bytes from &#8220;little-end&#8221; (least significant bit) or &#8220;big-end&#8221; (most significant bit).<br>
Thus, a 3-byte integer <code>&lt;&lt;74, 0, 0&gt;&gt;</code> in &#8220;big-endian&#8221; is indeed <code>4849664</code> but in &#8220;little-endian&#8221; it&#8217;s <code>74</code>. Fortunately, bitstring syntax has great support for endianess and it&#8217;s as easy as adding <code>little</code> modifier (&#8220;big-endian&#8221; is the default):</p>
<pre><code>iex&gt; &lt;&lt;payload_length::24-little, sequence_id::8, payload::binary&gt;&gt; = data
iex&gt; payload_length
74
</code></pre>
<p>To make sense of the remaining payload we&#8217;re gonna use the <a href="https://hex.pm/packages/binpp" target="_blank" rel="noopener"><code>binpp</code></a> package:</p>
<pre><code>iex&gt; :binpp.pprint(payload)
0000 0A 38 2E 30 2E 31 32 00 0F 00 00 00 27 73 79 59  .8.0.12.....'syY
0001 7A 34 26 3B 00 FF FF FF 02 00 FF C3 15 00 00 00  z4&amp;;.ÿÿÿ..ÿÃ....
0002 00 00 00 00 00 00 00 43 55 6B 60 74 5A 71 08 75  .......CUk`tZq.u
0003 6F 08 2F 00 63 61 63 68 69 6E 67 5F 73 68 61 32  o./.caching_sha2
0004 5F 70 61 73 73 77 6F 72 64 00                    _password.
</code></pre>
<p>We can see up to 16 bytes in each row and at the far right we have ASCII interpretation of each byte. Per <a href="https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake">&#8220;Initial Handshake Packet&#8221;</a> the first byte is the protocol version, always <code>10</code> (<code>0x0A</code>), and what follows is a null-terminated server version string. Let&#8217;s extract that:</p>
<pre><code>iex&gt; &lt;&lt;10, rest::binary&gt;&gt; = payload
iex&gt; [server_version, rest] = :binary.split(rest, &lt;&lt;0x00&gt;&gt;)
iex&gt; server_version
"8.0.12"
</code></pre>
<p>We can parse the server version, that&#8217;s a good start! There are other fields in this packet that in a complete adapter we&#8217;d have to handle, but for now we&#8217;ll simply ignore them. We&#8217;ll just take a note of the authentication method at the end to the packet, a null-terminated string <code>"caching_sha2_password"</code>.</p>
<p>After receiving &#8220;Initial Handshake Packet&#8221; the client is supposed to send <a href="https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::HandshakeResponse" target="_blank" rel="noopener">&#8220;Handshake Response&#8221;</a>. We&#8217;ll again just gloss over the details:</p>
<pre><code>iex&gt; use Bitwise
iex&gt; capability_flags = 0x00000200 ||| 0x00008000 ||| 0x00080000
iex&gt; max_packet_size = 65535
iex&gt; charset = 0x21
iex&gt; username = "myxql_test"
iex&gt; auth_response = &lt;&lt;0x00&gt;&gt;
iex&gt; client_auth_plugin = "caching_sha2_password"
iex&gt; payload = &lt;&lt;
       capability_flags::32-little,
       max_packet_size::32-little,
       charset, 0::8*23,
       username::binary, 0x00,
       auth_response::binary,
       client_auth_plugin::binary, 0x00
>&gt;
iex&gt; sequence_id = 1
iex&gt; data = &lt;&lt;byte_size(payload)::24-little, sequence_id, payload::binary&gt;&gt;
</code></pre>
<p>Let&#8217;s break this down:</p>
<p>First, we use <code>CLIENT_PROTOCOL_41</code>,<code>CLIENT_SECURE_CONNECTION</code>, and <code>CLIENT_PLUGIN_AUTH</code> <a href="https://dev.mysql.com/doc/internals/en/capability-flags.html#packet-Protocol::CapabilityFlags" target="_blank" rel="noopener">capability flags</a> using &#8220;bitwise OR&#8221;. Secondly, we set the max packet size, charset (<code>0x21</code> is <code>utf8_general_ci</code>), filler (<code>0</code>s repeated 23 times), username, auth response (empty password is a null byte), and auth plugin name. Note, we encode <code>username</code> and <code>client_auth_plugin</code> as null-terminated strings. Finally, we generate <code>payload</code> and encode it in a packet with payload length and sequence id (it&#8217;s 2nd packet so sequence id is <code>1</code>). Let&#8217;s now send this and receive response from the server:</p>
<pre><code>iex&gt; :ok = :gen_tcp.send(sock, data)
iex&gt; {:ok, data} = :gen_tcp.recv(sock, 0)
iex&gt; &lt;&lt;payload_length::24-little, sequence_id::8, payload::binary&gt;&gt; = data
iex&gt; :binpp.pprint(payload)
0000 00 00 00 02 00 00 00
</code></pre>
<p>The first byte of the response is <code>0x00</code> which corresponds to the <a href="https://dev.mysql.com/doc/internals/en/packet-OK_Packet.html" target="_blank" rel="noopener"><code>OK_Packet</code></a>, authentication succedded! Even though we&#8217;ve glossed over many details, we&#8217;ve shown that we can integrate with the server end-to-end and that&#8217;s going to be a foundation we&#8217;ll built upon. There are many more packets that we&#8217;ll need to encode or decode and we&#8217;re gonna need a more structured approach which we will discuss in part II.</p>
<p><a href="https://pages.plataformatec.com.br/elixir-development-subscription"><img fetchpriority="high" decoding="async" class="aligncenter size-large wp-image-7816" src="/wp-content/uploads/2018/10/Elixir_2-1-1024x213.png" alt="banner-elixir development subscription" width="1024" height="213" srcset="/wp-content/uploads/2018/10/Elixir_2-1-1024x213.png 1024w, /wp-content/uploads/2018/10/Elixir_2-1-300x63.png 300w, /wp-content/uploads/2018/10/Elixir_2-1-768x160.png 768w, /wp-content/uploads/2018/10/Elixir_2-1.png 1200w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
    </article>
  
      <p class="post-metadata">
      Tags: <a href="/tag/ecto/" rel="tag">ecto</a>, <a href="/tag/elixir/" rel="tag">elixir</a>, Posted in <a href="/category/english/" rel="category tag">English</a>,   <span>Comments Off<span class="screen-reader-text"> on Building a new MySQL adapter for Ecto, Part I: Hello World</span></span>    </p>
  </section>

        <div class="comments-thread">
          
<!-- You can start editing here. -->


			<!-- If comments are closed. -->
		<p class="nocomments">Comments are closed.</p>

	
        </div>

        <div class="pagination-section">
          <a href="/2018/11/conquistando-melhoria-continua-atraves-de-retrospectivas-ludicas/" rel="prev">Conquistando Melhoria Contínua Através de Retrospectivas Lúdicas</a>          <a href="/2018/11/whats-new-in-elixir-nov-18/" rel="next">What&#8217;s new in Elixir &#8211; Nov/18</a>        </div>
        </div>
  <aside class="sidebar-container">
  <div class="sidebar-box sidebar-box-divider">
    <ul class="social-links">
      <li><a href="/feed/" class="social-link rss-link" title="Subscribe to our RSS" target="_blank">Subscribe to our RSS</a></li>
      <li><a href="http://twitter.com/plataformatec" class="social-link twitter-link" title="Follow us on Twitter" target="_blank">@plataformatec</a></li>
      <li><a href="https://github.com/plataformatec" class="social-link github-link" title="Check our code at GitHub" target="_blank">Plataformatec @ GitHub</a></li>
      <li><a href="http://facebook.com/plataformatec.com.br" class="social-link facebook-link" title="Check our Facebook page" target="_blank">Plataformatec @ Facebook</a></li>
      <li><a href="http://www.linkedin.com/company/plataformatec" class="social-link linkedin-link" title="Check our LinkedIn page" target="_blank">Plataformatec @ LinkedIn</a></li>
    </ul>
  </div>

  <div class="sidebar-box sidebar-box-divider">
    This is the company blog of <strong>Plataformatec</strong>, a software development and
    consultancy company, specialized in Elixir, Ruby and Agile.
  </div>

  <div class="sidebar-box">
    <ul class="post-list">
      <li class="post-list-item">
<a href="/category/english">Posts in english</a> (107)</li>
      <li class="post-list-item">
<a href="/category/portugues">Posts em português</a> (33)</li>
    </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Recent Posts</h3>

    <ul class="post-list">
                    <li class="post-list-item">
          <a href="/2020/01/important-information-about-our-elixir-and-ruby-open-source-projects/">Important information about our Elixir and Ruby Open Source projects</a>
        </li>
              <li class="post-list-item">
          <a href="/2020/01/elixir-what-about-tests/">Elixir: What about tests?</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/12/okr-licoes-aprendidas-para-voce-comecar-a-aplica-lo-de-forma-efetiva/">OKR: lições aprendidas para você começar a aplicá-lo de forma efetiva</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/11/divida-tecnica-por-que-fazer-quando-fazer-e-como-priorizar/">Dívida técnica: Por que fazer, quando fazer e como priorizar</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/11/relation-between-story-points-and-development-time-lead-time/">Relation between Story Points and Development Time (Lead Time)</a>
        </li>
          </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Read more about</h3>

    <ul class="post-list">
      <li class="post-list-item"><a href="/tag/open-source">Open Source</a></li>
      <li class="post-list-item"><a href="/tag/front-end">Front end</a></li>
      <li class="post-list-item"><a href="/tag/conference">Conferences</a></li>
      <li class="post-list-item"><a href="/tag/security-fix">Security fixes</a></li>
    </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Check our product</h3>
    <a class="sidebar-cta-link" href="https://sourcelevel.io/">
      <img src="/wp-content/themes/ptec/assets/sourcelevel-300.png" width="300" alt="SourceLevel - Analytics for Engineering Ops">
	</a>

    <p align="center">Analytics for Engineering Ops.</p>
  </div>

</aside>
      <footer class="site-footer">
        <p>
          <span class="footer-copy">© 2009- 2024 Plataformatec. All rights reserved.</span>

          <a href="http://plataformatec.com.br/">Our site</a> ·
          <a href="http://plataformatec.com.br/contact">Contact us</a> ·
          <a href="http://twitter.com/plataformatec">@plataformatec</a>
        </p>
      </footer>
    </div>
                                                                                                                                                    <script type="text/javascript" src="/wp-content/themes/ptec/application.js?ver=6.4.2" id="application-js"></script>
  </body>
</html>