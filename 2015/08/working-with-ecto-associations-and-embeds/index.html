<!DOCTYPE html>
<html dir="ltr" lang="en-US" prefix="og: https://ogp.me/ns#">
<head>
  <meta charset="utf-8">
  <meta name="bitly-verification" content="b3acd9a47f4e">

  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="emoji:root" content="/wp-content/themes/ptec">
  <meta name="theme-color" content="#cacaca">
  
    <meta name="bitly-verification" content="b3acd9a47f4e">
  <meta property="og:image" content="/wp-content/themes/ptec/assets/opengraph.png">
  <link rel="icon" sizes="192x192" href="/wp-content/themes/ptec/assets/icons/chrome-192x.png">
  <link rel="pingback" href="/xmlrpc.php">
  
		<!-- All in One SEO 4.5.4 - aioseo.com -->
		<title>Working with Ecto associations and embeds « Plataformatec Blog</title>
		<meta name="description" content="This blog post aims to document how to work with associations in Ecto, covering how to read, insert, update and delete associated models and embeds.">
		<meta name="robots" content="max-image-preview:large">
		<meta name="keywords" content="ecto,associations,embeds,phoenix,elixir">
		<link rel="canonical" href="/2015/08/working-with-ecto-associations-and-embeds/">
		<meta name="generator" content="All in One SEO (AIOSEO) 4.5.4">
		<meta property="og:locale" content="en_US">
		<meta property="og:site_name" content="Plataformatec Blog | Plataformatec&#039;s place to talk about Ruby, Ruby on Rails, Elixir, and software engineering">
		<meta property="og:type" content="article">
		<meta property="og:title" content="Working with Ecto associations and embeds « Plataformatec Blog">
		<meta property="og:description" content="This blog post aims to document how to work with associations in Ecto, covering how to read, insert, update and delete associated models and embeds.">
		<meta property="og:url" content="/2015/08/working-with-ecto-associations-and-embeds/">
		<meta property="article:published_time" content="2015-08-12T08:00:35+00:00">
		<meta property="article:modified_time" content="2016-12-01T11:32:06+00:00">
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content="Working with Ecto associations and embeds « Plataformatec Blog">
		<meta name="twitter:description" content="This blog post aims to document how to work with associations in Ecto, covering how to read, insert, update and delete associated models and embeds.">
		<meta name="google" content="nositelinkssearchbox">
		<script type="application/ld+json" class="aioseo-schema">{"@context":"https:\/\/schema.org","@graph":[{"@type":"Article","@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#article","name":"Working with Ecto associations and embeds « Plataformatec Blog","headline":"Working with Ecto associations and embeds","author":{"@id":"\/author\/josevalim\/#author"},"publisher":{"@id":"\/#organization"},"image":{"@type":"ImageObject","url":"\/wp-content\/uploads\/2015\/05\/elixir-radar-subscribe.png","@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#articleImage","width":831,"height":207,"caption":"Subscribe to Elixir Radar"},"datePublished":"2015-08-12T05:00:35-03:00","dateModified":"2016-12-01T09:32:06-02:00","inLanguage":"en-US","commentCount":5,"mainEntityOfPage":{"@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#webpage"},"isPartOf":{"@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#webpage"},"articleSection":"English, ecto, elixir"},{"@type":"BreadcrumbList","@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#breadcrumblist","itemListElement":[{"@type":"ListItem","@id":"\/#listItem","position":1,"name":"Home","item":"\/","nextItem":"\/2015\/#listItem"},{"@type":"ListItem","@id":"\/2015\/#listItem","position":2,"name":"2015","item":"\/2015\/","nextItem":"\/2015\/08\/#listItem","previousItem":"\/#listItem"},{"@type":"ListItem","@id":"\/2015\/08\/#listItem","position":3,"name":"August","item":"\/2015\/08\/","nextItem":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#listItem","previousItem":"\/2015\/#listItem"},{"@type":"ListItem","@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#listItem","position":4,"name":"Working with Ecto associations and embeds","previousItem":"\/2015\/08\/#listItem"}]},{"@type":"Organization","@id":"\/#organization","name":"Plataformatec Blog","url":"\/"},{"@type":"Person","@id":"\/author\/josevalim\/#author","url":"\/author\/josevalim\/","name":"José Valim","image":{"@type":"ImageObject","@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#authorImage","url":"https:\/\/secure.gravatar.com\/avatar\/e837f6b7fd146ab16ed3d663476c063e?s=96&d=mm&r=pg","width":96,"height":96,"caption":"José Valim"}},{"@type":"WebPage","@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#webpage","url":"\/2015\/08\/working-with-ecto-associations-and-embeds\/","name":"Working with Ecto associations and embeds « Plataformatec Blog","description":"This blog post aims to document how to work with associations in Ecto, covering how to read, insert, update and delete associated models and embeds.","inLanguage":"en-US","isPartOf":{"@id":"\/#website"},"breadcrumb":{"@id":"\/2015\/08\/working-with-ecto-associations-and-embeds\/#breadcrumblist"},"author":{"@id":"\/author\/josevalim\/#author"},"creator":{"@id":"\/author\/josevalim\/#author"},"datePublished":"2015-08-12T05:00:35-03:00","dateModified":"2016-12-01T09:32:06-02:00"},{"@type":"WebSite","@id":"\/#website","url":"\/","name":"Plataformatec Blog","description":"Plataformatec's place to talk about Ruby, Ruby on Rails, Elixir, and software engineering","inLanguage":"en-US","publisher":{"@id":"\/#organization"}}]}</script>
		<!-- All in One SEO -->


		<!-- Meta Tag Manager -->
		<meta name="twitter:label1" content="Plataformatec">
		<meta name="twitter:data1" content="Professional Consulting and Development for companies using Elixir or Ruby">
		<!-- / Meta Tag Manager -->
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Comments Feed" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Plataformatec Blog &raquo; Working with Ecto associations and embeds Comments Feed" href="/2015/08/working-with-ecto-associations-and-embeds/feed/">
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.4.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🫱🏻‍🫲🏿","🫱🏻​🫲🏿")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=6.4.2" type="text/css" media="all">
<style id="wp-block-library-inline-css" type="text/css">.has-text-align-justify{text-align:justify;}</style>
<link rel="stylesheet" id="mediaelement-css" href="/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css?ver=4.2.17" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="/wp-includes/js/mediaelement/wp-mediaelement.min.css?ver=6.4.2" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="webfont-css" href="//fonts.googleapis.com/css?family=Bree+Serif&#038;ver=6.4.2" type="text/css" media="all">
<link rel="stylesheet" id="main-css" href="/wp-content/themes/ptec/style.css?ver=6.4.2" type="text/css" media="all">
<link rel="stylesheet" id="tablepress-default-css" href="/wp-content/plugins/tablepress/css/build/default.css?ver=2.2.4" type="text/css" media="all">
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/4878">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.4.2">
<link rel="shortlink" href="/?p=4878">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F2015%2F08%2Fworking-with-ecto-associations-and-embeds%2F">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=https%3A%2F%2F%2F2015%2F08%2Fworking-with-ecto-associations-and-embeds%2F#038;format=xml">
</head>
  <body class="post-template-default single single-post postid-4878 single-format-standard">
    <div class="site-header">
      <div class="site-header-background">
        <header class="site-header-container">
          <h1 class="site-header-logo">
            <a href="/">
              <img src="/wp-content/themes/ptec/assets/plataformatec.svg" height="70" alt="The plataformatec logo">
            </a>
          </h1>

          <form class="header-search-form" method="GET" action="/">
            <input type="search" name="s" placeholder="Search our blog..." class="header-search-input">
          </form>

          <ul class="site-nav">
            <li class="site-nav-item"><a href="http://plataformatec.com.br/services">Services</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/playbook">Playbook</a></li>
            <li class="site-nav-item handheld-hidden"><a href="http://plataformatec.com.br/forge">Forge</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/careers">Careers</a></li>
            <li class="site-nav-item"><a href="http://plataformatec.com.br/contact">Contact</a></li>
          </ul>
        </header>
      </div>
      <nav class="header-nav">
        <input type="checkbox" id="nav-toggle-checkbox" class="header-nav-checkbox">
        <label for="nav-toggle-checkbox" class="header-nav-toggle">Topics we write about</label>

        <ul class="header-nav-list" itemscope itemtype="http://schema.org/SiteNavigationElement">
          <li class="header-nav-item header-search-nav-item">
            <form class="header-nav-search-form" method="GET" action="/">
              <input type="search" name="s" placeholder="Search our blog..." class="header-search-input">
            </form>
          </li>
                    <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/elixir" itemprop="url">Elixir</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/rails" itemprop="url">Ruby on Rails</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/devise" itemprop="url">Devise</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/simple_form" itemprop="url">Simple Form</a>
          </li>
          <li class="header-nav-item" itemprop="name">
            <a class="header-nav-link" href="/tag/agile" itemprop="url">Agile</a>
          </li>
        </ul>
      </nav>
    </div>
<div class="site-container">
  <div class="page-container">
                  <section class="post-section">
  <header class="post-header">
    <h1 class="post-title">
      <a href="/2015/08/working-with-ecto-associations-and-embeds/" rel="bookmark">Working with Ecto associations and embeds</a>
    </h1>
          <time class="post-date-ribbon" datetime="2015-08-12T05:00:35-03:00">Aug 12, 2015</time>
      <p class="post-author">
        <img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">        Written by <a href="/?author=4" title="Posts by José Valim">José Valim</a>.
      </p>
        </header>

      <article class="post-body">
      <p>This blog post aims to document how to work with associations in Ecto, covering how to read, insert, update and delete associations and embeds. At the end, we give a more complex example that uses Ecto associations to build nested forms in Phoenix.</p>
<p>This article expects basic knowledge Ecto, particularly how repositories, schema and the query syntax work. You can learn more about those <a href="http://hexdocs.pm/ecto/">in Ecto docs</a>.</p>
<blockquote><p>
  Note: this article has been updated to Ecto 2.0 by using the new <code>cast_assoc</code> and <code>cast_embed</code> APIs.
</p></blockquote>
<h2>Associations</h2>
<p>Associations in Ecto are used when two different sources (tables) are linked via foreign keys.</p>
<p>A classic example of this setup is &#8220;Post has many comments&#8221;. First create the two tables in migrations:</p>
<pre><code class="elixir">create table(:posts) do
  add :title, :string
  add :body, :text
  timestamps
end

create table(:comments) do
  add :post_id, references(:posts)
  add :body, :text
  timestamps
end
</code></pre>
<p>Each comment contains a <code>post_id</code> column that by default points to a post <code>id</code>.</p>
<p>And now define the schemas:</p>
<pre><code class="elixir">defmodule MyApp.Post do
  use Ecto.Schema

  schema "posts" do
    field :title
    field :body
    has_many :comments, MyApp.Comment
    timestamps
  end
end

defmodule MyApp.Comment do
  use Ecto.Schema

  schema "comments" do
    field :body
    belongs_to :post, MyApp.Post
    timestamps
  end
end
</code></pre>
<p>All the schema definitions like <code>field</code>, <code>has_many</code> and others are defined in <a href="http://hexdocs.pm/ecto/Ecto.Schema.html"><code>Ecto.Schema</code></a>.</p>
<p>Similar to <code>has_many/3</code>, a schema can also invoke <code>has_one/3</code> when the parent has at most one child entry. For example, you could think of a metadata association where &#8220;Post has one metadata&#8221; and the &#8220;Metadata belongs to post&#8221;.</p>
<p>The difference between <code>has_one/3</code> and <code>belongs_to/3</code> is that the foreign key is always defined in the schema that invokes <code>belongs_to/3</code>. You can think of the schema that calls <code>has_*</code> as the parent schema and the one that invokes <code>belongs_to</code> as the child one.</p>
<h3>Querying associations</h3>
<p>One of the benefits of defining associations is that they can be used in queries. For example:</p>
<pre><code class="elixir">Repo.all from p in Post,
            preload: [:comments]
</code></pre>
<p>Now all posts will be fetched from the database with their associated comments. The example above will perform two queries: one for loading all posts and another for loading all comments. This is often the most efficient way of loading associations from the database (even if two queries are performed) because we need to receive and parse only POSTS + COMMENTS results.</p>
<p>It is also possible to preload associations using joins while performing more complex queries. For example, imagine both posts and comments have votes and you want only comments with more votes than the post itself:</p>
<pre><code class="elixir">Repo.all from p in Post,
            join: c in assoc(p, :comments),
            where: c.votes &gt; p.votes
            preload: [comments: c]
</code></pre>
<p>The example above will now perform a single query, finding all posts and the respective comments that match the criteria. Because this query performs a JOIN, the number of results returned by the database is POSTS * COMMENTS, which Ecto then processes and associates all comments into the appropriate post.</p>
<p>Finally, Ecto also allows data to be preloaded into structs after they have been loaded via the <code>Repo.preload/3</code> function:</p>
<pre><code class="elixir">Repo.preload posts, :comments
</code></pre>
<p>This is specially handy because Ecto does not support lazy loading. If you invoke <code>post.comments</code> and comments have not been preloaded, it will return <code>Ecto.Association.NotLoaded</code>. Lazy loading is often a source of confusion and performance issues and Ecto pushes developers to do the proper thing. Therefore <code>Repo.preload/3</code> allow associations to be explicitly loaded anywhere, at any time.</p>
<h3>Manipulating associations</h3>
<p>While Ecto 2.0 allows you insert a post with multiple comments in one operation:</p>
<pre><code class="elixir">Repo.insert!(%Post{
  title: "Hello",
  body: "world",
  comments: [
    %Comment{body: "Excellent!"}
  ]
})
</code></pre>
<p>Many times you may want to break it into distinct steps so you have more flexibility in managing those entries. For example, you could use changesets to build your posts and comments along the way:</p>
<pre><code class="elixir">post = Ecto.Changeset.change(%Post{}, title: "Hello", body: "world")
comment = Ecto.Changeset.change(%Comment{}, body: "Excellent!")
post_with_comments = Ecto.Changeset.put_assoc(post, :comments, [comment])
Repo.insert!(post_with_comments)
</code></pre>
<p>Or by handling each entry individually inside a transaction:</p>
<pre><code class="elixir">Repo.transaction fn -&gt;
  post = Repo.insert!(%Post{title: "Hello", body: "world"})

  # Build a comment from the post struct
  comment = Ecto.build_assoc(post, :comments, body: "Excellent!")

  Repo.insert!(comment)
end
</code></pre>
<p><code>Ecto.build_assoc/3</code> builds the comment using the id currently set in the post struct. It is equivalent to:</p>
<pre><code class="elixir">%Comment{post_id: post.id, body: "Excellent!"}
</code></pre>
<p>The <a href="http://hexdocs.pm/ecto/Ecto.html#build_assoc/3"><code>Ecto.build_assoc/3</code></a> function is specially useful in <a href="http://phoenixframework.org/">Phoenix</a> controllers. For example, when creating the post, one would do:</p>
<pre><code class="elixir">Ecto.build_assoc(current_user, :post)
</code></pre>
<p>As we likely want to associate the post to the user currently signed in the application. In another controller, we could build a comment for an existing post with:</p>
<pre><code class="elixir">Ecto.build_assoc(post, :comments)
</code></pre>
<p>Ecto does not provide functions like <code>post.comments &lt;&lt; comment</code> that allows mixing persisted data with non-persisted data. The only mechanism for changing both post and comments at the same time is via changesets which we will explore when talking about embeds and nested associations.</p>
<h3>Deleting associations</h3>
<p>When defining a <code>has_many/3</code>, <code>has_one/3</code> and friends, you can also pass a <code>:on_delete</code> option that specifies which action should be performed on associations when the parent is deleted.</p>
<pre><code class="elixir">has_many :comments, MyApp.Comment, on_delete: :delete_all
</code></pre>
<p>Besides the value above, <code>:nilify_all</code> is also supported, with <code>:nothing</code> being the default. Check <a href="http://hexdocs.pm/ecto/Ecto.Schema.html#has_many/3"><code>has_many/3</code></a> docs for more information.</p>
<h2>Embeds</h2>
<p>Besides associations, Ecto also supports embeds in some databases. With embeds, the child is embedded inside the parent, instead of being stored in another table.</p>
<p>Databases like PostgreSQL uses a mixture of JSONB (<code>embeds_one/3</code>) and ARRAY columns to provide this functionality (both JSONB and ARRAY are supported by default and first-class citizens in Ecto).</p>
<p>Working with embeds is mostly the same as working with another field in a schema, except when it comes to manipulating them. Let&#8217;s see an example:</p>
<pre><code class="elixir">defmodule MyApp.Permalink do
  use Ecto.Schema

  embedded_schema do
    field :url
    timestamps
  end
end

defmodule MyApp.Post do
  use Ecto.Schema

  schema "posts" do
    field :title
    field :body
    has_many :comments, MyApp.Comment
    embeds_many :permalinks, MyApp.Permalink
    timestamps
  end
end
</code></pre>
<p>It is possible to insert a post with multiple permalinks directly:</p>
<pre><code class="elixir">Repo.insert!(%Post{
  title: "Hello",
  permalinks: [
    %Permalink{url: "example.com/thebest"},
    %Permalink{url: "another.com/mostaccessed"}
  ]
})
</code></pre>
<p>Similar to associations, you may also manage those entries using changesets:</p>
<pre><code class="elixir"># Generate a changeset for the post
changeset = Ecto.Changeset.change(post)

# Let's track the new permalinks
changeset = Ecto.Changeset.put_embed(changeset, :permalinks,
  [%Permalink{url: "example.com/thebest"},
   %Permalink{url: "another.com/mostaccessed"}]
)

# Now insert the post with permalinks at once
post = Repo.insert!(changeset)
</code></pre>
<p>Now if you want to replace or remove a particular permalink, you can work with permalinks as a collection and then just put it as a change again:</p>
<pre><code class="elixir"># Remove all permalinks from example.com
permalinks = Enum.reject post.permalinks, fn permalink -&gt;
  permalink.url =~ "example.com"
end

# Let's create a new changeset
changeset =
  post
  |&gt; Ecto.Changeset.change
  |&gt; Ecto.Changeset.put_embed(:permalinks, permalinks)

# And update the entry
post = Repo.update!(changeset)
</code></pre>
<p>The beauty of working with changesets is that they keep track of all changes that will be sent to the database and we can introspect them at any time. For example, if we called before <code>Repo.update!/3</code>:</p>
<pre><code class="elixir">IO.inspect(changeset.changes.permalinks)
</code></pre>
<p>We would see something like:</p>
<pre><code class="elixir">[%Ecto.Changeset{action: :delete, changes: %{},
                 model: %Permalink{url: "example.com/thebest"}},
 %Ecto.Changeset{action: :update, changes: %{},
                 model: %Permalink{url: "another.com/mostaccessed"}}]
</code></pre>
<p>If, by any chance, we were also inserting a permalink in this operation, we would see another changeset there with action <code>:insert</code>.</p>
<p>Changesets contain a complete view of what is changing, how they are changing and you can manipulate them directly.</p>
<h2>Nested associations and embeds</h2>
<p>The same way we have used changesets to manipulate embeds, we can also use them to change child associations at the same time we are manipulating the parent.</p>
<p>One of the benefits of this feature is that we can use them to build nested forms in a Phoenix application. While nested forms in other languages and frameworks can be confusing and complex, Ecto uses changesets and explicit validations to provide a straightforward and simple way to manipulate multiple structs at once.</p>
<p>To finish this post, let&#8217;s see an example of how to use what we have seen so far to work with nested associations in Phoenix.</p>
<blockquote><p>
  Note: you will need <code>phoenix_ecto 3.0</code> in order to follow this example.
</p></blockquote>
<p>First, create a new Phoenix application if you haven&#8217;t yet. The <a href="http://phoenixframework.org/">Phoenix guides</a> can help you get started with that if it is your first time using Phoenix.</p>
<p>The example we will build is a classic to do list, where a list has many items. Let&#8217;s generate the <code>TodoList</code> resource:</p>
<pre><code>mix phoenix.gen.html TodoList todo_lists title
</code></pre>
<p>Follow the steps printed by the command above and after let&#8217;s generate a <code>TodoItem</code> model:</p>
<pre><code>mix phoenix.gen.model TodoItem todo_items body:text todo_list_id:references:todo_lists
</code></pre>
<p>Open up the <code>MyApp.TodoList</code> module at &#8220;web/models/todo_list.ex&#8221; and add the <code>has_many</code> definition inside the <code>schema</code> block:</p>
<pre><code class="elixir">has_many :todo_items, MyApp.TodoItem
</code></pre>
<p>Next let&#8217;s also cast &#8220;todo_items&#8221; on the <code>TodoList</code> changeset function:</p>
<pre><code class="elixir">def changeset(todo_list, params \\ %{}) do
  todo_list
  |&gt; cast(params, [:body])
  |&gt; cast_assoc(:todo_items, required: true)
end
</code></pre>
<p>Note we are using <code>cast_assoc</code> instead of <code>put_assoc</code> in this example. Both functions are defined in <code>Ecto.Changeset</code>. <code>cast_assoc</code> (or <code>cast_embed</code>) is used when you want to manage associations or embeds based on external parameters, such as the data received through Phoenix forms. In such cases, Ecto will compare the data existing in the struct with the data sent through the form and generate the proper operations. On the other hand, we use <code>put_assoc</code> (or <code>put_embed</code>) when we aleady have the associations (or embeds) as structs and changesets, and we simply want to tell Ecto to take those entries as is.</p>
<p>Because we have added <code>todo_items</code> as a required field, we are ready to submit them through the form. So let&#8217;s change our template to submit todo items too. Open up &#8220;web/templates/todo_list/form.html.eex&#8221; and add the following between the title input and the submit button:</p>
<pre><code class="erb">&lt;%= inputs_for f, :todo_items, fn i -&gt; %&gt;
  &lt;div class="form-group"&gt;
    &lt;%= label i, :body, "Task ##{i.index + 1}", class: "control-label" %&gt;
    &lt;%= text_input i, :body, class: "form-control" %&gt;
    &lt;%= if message = i.errors[:body] do %&gt;
      &lt;span class="help-block"&gt;&lt;%= message %&gt;&lt;/span&gt;
    &lt;% end %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</code></pre>
<p>The <code>inputs_for/4</code> function <a href="http://hexdocs.pm/phoenix_html/Phoenix.HTML.Form.html#inputs_for/4">comes from Phoenix.HTML.Form</a> and it allows us to generate fields for an association or an embed, emitting a new form struct (represented by the variable <code>i</code> in the example above) for us to work with. Inside the <code>inputs_for/4</code> function, we generate a text input for each item.</p>
<p>Now that we have changed the template, the final step is to change the <code>new</code> action in the controller to include two empty todo items by default in the todo list:</p>
<pre><code class="elixir">changeset = TodoList.changeset(%TodoList{todo_items: [%MyApp.TodoItem{}, %MyApp.TodoItem{}]})
</code></pre>
<p>Head to &#8220;http://localhost:4000/todo_lists&#8221; and you can now create a todo list with both items! However, if you try to edit the newly created todo list, you should get an error:</p>
<pre><code>attempting to cast or change association :todo_items for MyApp.TodoList that was not loaded.
Please preload your associations before casting or changing the model.
</code></pre>
<p>As the error message says we need to preload the todo items<br>
for both <code>edit</code> and <code>update</code> actions in <code>MyApp.TodoListController</code>.<br>
Open up your controller and change the following line on both actions:</p>
<pre><code class="elixir">todo_list = Repo.get!(TodoList, id)
</code></pre>
<p>to</p>
<pre><code class="elixir">todo_list = Repo.get!(TodoList, id) |&gt; Repo.preload(:todo_items)
</code></pre>
<p>Now it should also be possible to update the todo items alongside the todo list.</p>
<p>Both insert and update operations are ultimately powered by changesets, as we can see in our controller actions:</p>
<pre><code class="elixir">changeset = TodoList.changeset(todo_list, todo_list_params)
</code></pre>
<p>All the benefits we have discussed regarding changesets in the previous section still apply here. By inspecting the changeset before calling <code>Repo.insert</code> or <code>Repo.update</code>, it is possible to see a snapshot of all the changes that are going to happen in the database.</p>
<p>Not only that, the validation process behind changesets is explicit. Since we added <code>todo_items</code> as a required field in the todo list model, every time we call <code>MyApp.TodoList.changeset/2</code>, <code>MyApp.TodoItem.changeset/2</code> will be called for every todo item sent through the form. The changesets returned for each todo item is then stored in the main todo list changeset (it is effectively a tree of changes).</p>
<p>To help us build our intuition regarding changesets a bit more, let&#8217;s add some validations to todo items and also allow them to be deleted.</p>
<h3>Deleting todo items</h3>
<p>Open up the <code>MyApp.TodoItem</code> at &#8220;web/models/todo_item.ex&#8221; and add a virtual field named <code>:delete</code> to the schema:</p>
<pre><code class="elixir">field :delete, :boolean, virtual: true
</code></pre>
<p>As we know the <code>MyApp.TodoItem.changeset/2</code> function is the one invoked by default when manipulating todo items through todo lists. So let&#8217;s change it to the following:</p>
<pre><code class="elixir">@required_fields ~w(body)
@optional_fields ~w(delete) # 1. Make delete an optional field

def changeset(todo_item, params \\ :empty) do
  todo_item
  |&gt; cast(params, @required_fields, @optional_fields)
  |&gt; validate_length(:body, min: 3)
  |&gt; mark_for_deletion() # 2. Call mark for deletion
end

defp mark_for_deletion(changeset) do
  # If delete was set and it is true, let's change the action
  if get_change(changeset, :delete) do
    %{changeset | action: :delete}
  else
    changeset
  end
end
</code></pre>
<p>We have added a call to <code>validate_length</code> as well as a private function that checks if the <code>:delete</code> field changed and, if so, we mark the changeset action to be <code>:delete</code>.</p>
<p>The functions <code>cast</code>, <code>validate_length</code>, <code>get_change</code> and more are all part of <a href="http://hexdocs.pm/ecto/Ecto.Changeset.html">the <code>Ecto.Changeset</code> module</a>, which is automatically imported into Ecto models.</p>
<p>Let&#8217;s now change our view to include the delete field. Add the following somewhere inside the <code>inputs_for/4</code> call in &#8220;web/templates/todo_list/form.html.eex&#8221;:</p>
<pre><code class="erb">&lt;%= if i.model.id do %&gt;
  &lt;span class="pull-right"&gt;
    &lt;%= label i, :delete, "Delete?", class: "control-label" %&gt;
    &lt;%= checkbox i, :delete %&gt;
  &lt;/span&gt;
&lt;% end %&gt;
</code></pre>
<p>And that&#8217;s all. Our todo items should now validate the body as well as allow deletion on update pages!</p>
<p>Notice we had control over the changeset and validations at all times. There are no special fields for deletion or implicit validation. Still, we were able to wire everything up with very few lines of codes.</p>
<p>And while the default is to call <code>MyApp.TodoItem.changeset/2</code>, it is possible to customize the function to be invoked when casting todo items from the todo list changeset via the <code>:with</code> option:</p>
<pre><code class="elixir">|&gt; cast_assoc(:todo_items, required: true, with: &amp;custom_changeset/2)
</code></pre>
<p>Therefore if an association has different validation rules depending if it is sent as part of a nested association or when managed directly, we can easily keep those business rules apart by providing two different changeset functions. And because we just use functions, all the way down, they are easy to compose and test.</p>
<h2>Summing up</h2>
<p>In this blog post we have learned the foundations for working with associations and embeds, up to a more complex example using nested associations. If you want to further customize their behavior, read the docs for declaring the associations/embeds in <a href="http://hexdocs.pm/ecto/Ecto.Schema.html"><code>Ecto.Schema</code></a> or how to further manipulate changesets via <a href="http://hexdocs.pm/ecto/Ecto.Changeset.html"><code>Ecto.Changeset</code></a>.</p>
<p>When it comes to the view, you can find more information on the <code>Phoenix.HTML</code> project, specially under the <a href="http://hexdocs.pm/phoenix_html/Phoenix.HTML.Form.html"><code>Phoenix.HTML.Form</code></a>, where the <code>inputs_for/4</code> function is defined.</p>
<p><a href="http://plataformatec.com.br/elixir-radar"><br>
  <img decoding="async" src="/wp-content/uploads/2015/05/elixir-radar-subscribe.png" alt="Subscribe to Elixir Radar" style="border:0"><br>
</a></p>
    </article>
  
      <p class="post-metadata">
      Tags: <a href="/tag/ecto/" rel="tag">ecto</a>, <a href="/tag/elixir/" rel="tag">elixir</a>, Posted in <a href="/category/english/" rel="category tag">English</a>,   <a href="/2015/08/working-with-ecto-associations-and-embeds/#comments"><span class="dsq-postid" data-dsqidentifier="4878 http://blog.plataformatec.com.br/?p=4878">5 Comments &#187;</span></a>    </p>
  </section>

        <div class="comments-thread">
          
<!-- You can start editing here. -->

	<h3 id="comments">
		5 responses to &#8220;Working with Ecto associations and embeds&#8221;	</h3>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1" id="comment-1509">
				<div id="div-comment-1509" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/2987b04feb26bb194664ddcca45ac7ef?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/2987b04feb26bb194664ddcca45ac7ef?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">			<cite class="fn">Tallak tveide</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2015/08/working-with-ecto-associations-and-embeds/#comment-1509">August 12, 2015 at 8:39 am</a>		</div>

		<p># Generate a changeset for the post<br>
changeset = Ecto.Changeset.change(post)</p>
<p># Let&#8217;s track the new permalinks<br>
changeset = Ecto.Changeset.put_change(post, :permalinks,<br>
  [%Permalink{url: &#8220;example.com/thebest&#8221;},<br>
   %Permalink{url: &#8220;another.com/mostaccessed&#8221;}]<br>
)</p>
<p># Now let&#8217;s insert the post with permalinks at once!<br>
post = Repo.insert!(changeset)</p>
<p>&#8212;</p>
<p>Should the post on line 5 be changeset?</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1510">
				<div id="div-comment-1510" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" decoding="async">			<cite class="fn"><a href="/" class="url" rel="ugc">josevalim</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2015/08/working-with-ecto-associations-and-embeds/#comment-1510">August 12, 2015 at 8:50 am</a>		</div>

		<p>As the documentation for Repo.insert! says, it receives a model (post) or a changeset and it always returns the model (post) in case of success. It raises on failures.</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1511">
				<div id="div-comment-1511" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/2987b04feb26bb194664ddcca45ac7ef?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/2987b04feb26bb194664ddcca45ac7ef?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn">Tallak tveide</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2015/08/working-with-ecto-associations-and-embeds/#comment-1511">August 12, 2015 at 8:58 am</a>		</div>

		<p>I was thinking about:<br>
    changeset = Ecto.Changeset.put_change(post, :permalinks,<br>
perhaps should be<br>
    changeset = Ecto.Changeset.put_change(changeset, :permalinks,</p>
<p>As according to Ecto.Changeset docs:</p>
<p>put_change(changeset, key, value)</p>
<p>    Specs:</p>
<p>    put_change(t, atom, term) :: t</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1512">
				<div id="div-comment-1512" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/e837f6b7fd146ab16ed3d663476c063e?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn"><a href="/" class="url" rel="ugc">josevalim</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2015/08/working-with-ecto-associations-and-embeds/#comment-1512">August 12, 2015 at 9:09 am</a>		</div>

		<p>Ah yes, on line 5! Sorry, I will fix it ASAP. Thank you!</p>

		
				</div>
				</li>
<!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-1513">
				<div id="div-comment-1513" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="https://secure.gravatar.com/avatar/2987b04feb26bb194664ddcca45ac7ef?s=32&#038;d=mm&#038;r=pg" srcset="https://secure.gravatar.com/avatar/2987b04feb26bb194664ddcca45ac7ef?s=64&#038;d=mm&#038;r=pg 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" decoding="async">			<cite class="fn">Tallak tveide</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata">
			<a href="/2015/08/working-with-ecto-associations-and-embeds/#comment-1513">August 12, 2015 at 9:28 am</a>		</div>

		<p>perhaps delete the comment then 🙂</p>

		
				</div>
				</li>
<!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>

        </div>

        <div class="pagination-section">
          <a href="/2015/08/elixir-in-production-interview-adam-kittelson/" rel="prev">Elixir in production interview: Adam Kittelson</a>          <a href="/2015/09/rubyconf-br-2015-te-esperamos-la/" rel="next">RubyConf BR 2015, te esperamos lá</a>        </div>
        </div>
  <aside class="sidebar-container">
  <div class="sidebar-box sidebar-box-divider">
    <ul class="social-links">
      <li><a href="/feed/" class="social-link rss-link" title="Subscribe to our RSS" target="_blank">Subscribe to our RSS</a></li>
      <li><a href="http://twitter.com/plataformatec" class="social-link twitter-link" title="Follow us on Twitter" target="_blank">@plataformatec</a></li>
      <li><a href="https://github.com/plataformatec" class="social-link github-link" title="Check our code at GitHub" target="_blank">Plataformatec @ GitHub</a></li>
      <li><a href="http://facebook.com/plataformatec.com.br" class="social-link facebook-link" title="Check our Facebook page" target="_blank">Plataformatec @ Facebook</a></li>
      <li><a href="http://www.linkedin.com/company/plataformatec" class="social-link linkedin-link" title="Check our LinkedIn page" target="_blank">Plataformatec @ LinkedIn</a></li>
    </ul>
  </div>

  <div class="sidebar-box sidebar-box-divider">
    This is the company blog of <strong>Plataformatec</strong>, a software development and
    consultancy company, specialized in Elixir, Ruby and Agile.
  </div>

  <div class="sidebar-box">
    <ul class="post-list">
      <li class="post-list-item">
<a href="/category/english">Posts in english</a> (107)</li>
      <li class="post-list-item">
<a href="/category/portugues">Posts em português</a> (33)</li>
    </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Recent Posts</h3>

    <ul class="post-list">
                    <li class="post-list-item">
          <a href="/2020/01/important-information-about-our-elixir-and-ruby-open-source-projects/">Important information about our Elixir and Ruby Open Source projects</a>
        </li>
              <li class="post-list-item">
          <a href="/2020/01/elixir-what-about-tests/">Elixir: What about tests?</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/12/okr-licoes-aprendidas-para-voce-comecar-a-aplica-lo-de-forma-efetiva/">OKR: lições aprendidas para você começar a aplicá-lo de forma efetiva</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/11/divida-tecnica-por-que-fazer-quando-fazer-e-como-priorizar/">Dívida técnica: Por que fazer, quando fazer e como priorizar</a>
        </li>
              <li class="post-list-item">
          <a href="/2019/11/relation-between-story-points-and-development-time-lead-time/">Relation between Story Points and Development Time (Lead Time)</a>
        </li>
          </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Read more about</h3>

    <ul class="post-list">
      <li class="post-list-item"><a href="/tag/open-source">Open Source</a></li>
      <li class="post-list-item"><a href="/tag/front-end">Front end</a></li>
      <li class="post-list-item"><a href="/tag/conference">Conferences</a></li>
      <li class="post-list-item"><a href="/tag/security-fix">Security fixes</a></li>
    </ul>
  </div>

  <div class="sidebar-box">
    <h3 class="sidebar-title">Check our product</h3>
    <a class="sidebar-cta-link" href="https://sourcelevel.io/">
      <img src="/wp-content/themes/ptec/assets/sourcelevel-300.png" width="300" alt="SourceLevel - Analytics for Engineering Ops">
	</a>

    <p align="center">Analytics for Engineering Ops.</p>
  </div>

</aside>
      <footer class="site-footer">
        <p>
          <span class="footer-copy">© 2009- 2024 Plataformatec. All rights reserved.</span>

          <a href="http://plataformatec.com.br/">Our site</a> ·
          <a href="http://plataformatec.com.br/contact">Contact us</a> ·
          <a href="http://twitter.com/plataformatec">@plataformatec</a>
        </p>
      </footer>
    </div>
    <script type="text/javascript" src="/wp-content/themes/ptec/application.js?ver=6.4.2" id="application-js"></script>
  </body>
</html>